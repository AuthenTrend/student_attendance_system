(function(t){function e(e){for(var n,r,o=e[0],c=e[1],l=e[2],d=0,f=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&f.push(a[r][0]),a[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);u&&u(e);while(f.length)f.shift()();return i.push.apply(i,l||[]),s()}function s(){for(var t,e=0;e<i.length;e++){for(var s=i[e],n=!0,o=1;o<s.length;o++){var c=s[o];0!==a[c]&&(n=!1)}n&&(i.splice(e--,1),t=r(r.s=s[0]))}return t}var n={},a={index:0},i=[];function r(e){if(n[e])return n[e].exports;var s=n[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=n,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(s,n,function(e){return t[e]}.bind(null,n));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;i.push([0,"chunk-vendors","chunk-common"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"016c":function(t,e,s){},"0502":function(t,e,s){},"0d49":function(t,e,s){"use strict";var n=s("e53d"),a=s.n(n);a.a},"0eae":function(t,e,s){},"12b8":function(t,e,s){"use strict";var n=s("7eb4"),a=s.n(n);a.a},"161d":function(t,e,s){},1724:function(t,e,s){},"258f":function(t,e,s){},"2afa":function(t,e,s){},"2c29":function(t,e,s){"use strict";var n=s("55cd"),a=s.n(n);a.a},"37de":function(t,e,s){"use strict";var n=s("016c"),a=s.n(n);a.a},"38a8":function(t,e,s){"use strict";var n=s("161d"),a=s.n(n);a.a},"40f1":function(t,e,s){},4173:function(t,e,s){"use strict";var n=s("d2c0"),a=s.n(n);a.a},"55cd":function(t,e,s){},"56d7":function(t,e,s){"use strict";s.r(e);s("e260"),s("e6cf"),s("cca6"),s("a79d");var n=s("2b0e"),a=s("a925"),i=s("2b27"),r=s.n(i),o=s("ee98"),c=s.n(o),l=s("8832"),u=s.n(l),d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[t.prepared?s("div",{class:{blur:t.isBackgroundBlur}},[t.isLogin?s("div",{attrs:{id:"header"}},[s("div",{staticClass:"user-info"},[t._v(t._s(t.username))]),s("text-button",{on:{click:t.logout}},[t._v(t._s(t.$t("general.logout")))])],1):t._e(),t.isLogin&&!t.firstLogin?s("div",{attrs:{id:"menu"}},[s("div",{staticClass:"logo"},[t._v(" "+t._s(t.$t("system.name"))+" ")]),t._l(t.pageConfig,(function(e){return[e.show?s("div",{key:e.key,staticClass:"nav-item click-button",class:{active:t.currentPage.key===e.key},on:{click:function(s){return t.goPage(e)}}},[t._v(" "+t._s(t.$t(e.nameKey))+" ")]):t._e()]}))],2):t._e(),s("div",{class:{full:!t.isLogin||t.firstLogin},attrs:{id:"content-container"}},[s("router-view",{attrs:{id:"content"}})],1)]):t._e(),t.showLoading?s("div",{attrs:{id:"loading"}},[s("div",{staticClass:"bar"}),s("div",{staticClass:"bar"}),s("div",{staticClass:"bar"})]):t._e(),s("pop-windows"),s("notifications",{staticClass:"notification",attrs:{group:"attendance",duration:5e3}})],1)},f=[],p=(s("4160"),s("c975"),s("b0c0"),s("d3b7"),s("159b"),s("5530")),v=s("2f62"),m=[{key:"periods",nameKey:"page.periods",url:"/periods",routerName:"Periods",access:[0]},{key:"classes",nameKey:"page.classes",url:"/classes",routerName:"Classes",access:[0,1,2]},{key:"users",nameKey:"page.users",url:"/users",routerName:"Users",access:[0,1]},{key:"profile",nameKey:"page.profile",url:"/profile",routerName:"Profile",access:[0,1,2]}],_=(s("99af"),s("bc3a")),g=s.n(_),h=".";function y(){return g.a.get("".concat(h,"/classes")).then((function(t){return t.data}))}function $(t,e){this.msg=t,this.status=e}function C(t){return g.a.get("".concat(h,"/class/").concat(t)).then((function(t){return t.data}))}function w(t){return g.a.post("".concat(h,"/class"),t)}function k(t,e){return g.a.put("".concat(h,"/class/").concat(t),e)}function b(t){return g.a.delete("".concat(h,"/class/").concat(t)).then((function(t){return t.data}))}function x(){return g.a.get("".concat(h,"/campuses")).then((function(t){return t.data}))}function E(t){return g.a.post("".concat(h,"/campus"),{name:t,university:"university",periods:[{start_time:{hour:9,minute:10},end_time:{hour:10,minute:0}}]})}function I(t,e){return g.a.put("".concat(h,"/campus/").concat(t),e)}function O(t){return g.a.delete("".concat(h,"/campus/").concat(t))}function S(t){return g.a.post("".concat(h,"/fido_login"),t).then((function(t){return t.data}))}function N(t,e){return g.a.post("".concat(h,"/login"),{username:t,password:e}).then((function(t){return t.data}))}function L(){return g.a.get("".concat(h,"/users")).then((function(t){return t.data}))}function P(t){return g.a.get("".concat(h,"/user/").concat(t)).then((function(t){return t.data}))}function M(t){return g.a.post("".concat(h,"/user"),t).then((function(t){return t.data}))}function T(t){var e={username:t.username||t.name,id:t.id,type:t.type,classes:[]};return t.password&&(e.password=t.password),g.a.put("".concat(h,"/user/").concat(t.id),e).then((function(t){return t.data}))}function U(t,e){return g.a.post("".concat(h,"/user/").concat(t,"/key"),e).then((function(t){return t.data}))}function j(t,e){return g.a.delete("".concat(h,"/user/").concat(t,"/key/").concat(e)).then((function(t){return t.data}))}function D(t,e,s){return g.a.put("".concat(h,"/user/").concat(t,"/key"),{name:s,keyID:e}).then((function(t){return t.data}))}function K(t){return g.a.get("".concat(h,"/user/").concat(t,"/keys")).then((function(t){return t.data}))}function A(t){return g.a.get("".concat(h,"/user/").concat(t,"/records")).then((function(t){return t.data}))}function F(){return g.a.get("".concat(h,"/challenge")).then((function(t){return t.data}))}function H(t){return g.a.get("".concat(h,"/user/").concat(t,"/challenge")).then((function(t){return t.data}))}function J(t){"token_expire"!==t.data.error&&"invalid_access"!==t.data.error||(window.location.href="/#/login")}function R(){return g.a.post("".concat(h,"/logout")).then((function(t){return t.data}))}function B(t,e){return g.a.put("".concat(h,"/class/").concat(t,"/students"),e).then((function(t){return t.data}))}function q(t,e){return g.a.put("".concat(h,"/class/").concat(t,"/sign_in"),e).then((function(t){return t.data}))}function z(t){return g.a.post("".concat(h,"/class/").concat(t,"/sign_in")).then((function(t){return t.data}))}function V(t,e,s){return g.a.put("".concat(h,"/class/").concat(t,"/sign_in/").concat(e),s).then((function(t){return t.data}))}function W(t,e){return g.a.post("".concat(h,"/class/").concat(t,"/sign_in/").concat(e,"/finish")).then((function(t){return t.data}))}function Y(t,e,s,n){return n?g.a.get("".concat(h,"/class/").concat(t,"/sign_ins?index=").concat(s||0,"&limit=").concat(e||10,"&before=").concat(n)).then((function(t){return t.data})):g.a.get("".concat(h,"/class/").concat(t,"/sign_ins?index=").concat(s||0,"&limit=").concat(e||10)).then((function(t){return t.data}))}function G(t){var e=new FormData;return e.append("file",t,{type:"text/csv"}),g.a.post("".concat(h,"/users"),e,{headers:{"Content-Type":"multipart/form-data"}}).then((function(t){return t.data}))}function Q(t){return g.a.delete("".concat(h,"/user/").concat(t)).then((function(t){return t.data}))}function X(t){var e=new FormData;return e.append("file",t,{type:"text/csv"}),g.a.post("".concat(h,"/classes"),e,{headers:{"Content-Type":"multipart/form-data"}}).then((function(t){return t.data}))}g.a.interceptors.response.use((function(t){return t}),(function(t){return console.log(t.response.data.error),t.response&&t.response.data&&("invalid_access"===t.response.data.error||"token_expire"===t.response.data.error||"invalid_access"===t.response.data.message||"token_expire"===t.response.data.message)&&(document.cookie="",window.location.href="/#/login"),Promise.reject(t)})),$.prototype=Error.prototype;var Z={data:function(){return m.forEach((function(t){t.show=!0})),{isBackgroundBlur:!1,showLoading:!1,pageConfig:m,prepared:!1}},computed:Object(p["a"])(Object(p["a"])({},Object(v["e"])(["currentPage","userInfo","firstLogin"])),Object(v["c"])(["isLogin","username"])),watch:{$route:function(){var t=this;m.forEach((function(e){e.routerName===t.$router.currentRoute.name&&t.setPage(e)}))},username:function(){var t=this;t.pageConfig.forEach((function(e){e.show=e.access.indexOf(t.userInfo.type)>=0})),t.$forceUpdate()}},methods:Object(p["a"])(Object(p["a"])(Object(p["a"])({},Object(v["b"])(["setCurrentUserID"])),Object(v["d"])(["setPage","setToken","setFirstLogin"])),{},{logout:function(){var t=this;R().finally((function(){t.$router.push("/login")}))},goPage:function(t){this.setPage(t),this.$router.push(t.url)}}),mounted:function(){var t=this,e=localStorage.getItem("locale");e&&(this.$i18n.locale=e),t.$root.$on("pop-window",(function(){t.$nextTick((function(){t.isBackgroundBlur=!0}))})),t.$root.$on("close-window",(function(){t.$nextTick((function(){t.isBackgroundBlur=!1}))})),t.$root.$on("start-loading",(function(){t.showLoading=!0,t.isBackgroundBlur=!0})),t.$root.$on("stop-loading",(function(){t.showLoading=!1,t.isBackgroundBlur=!1})),m.forEach((function(e){e.routerName===t.$router.currentRoute.name&&t.setPage(e)}));var s=t.$cookies.get("sd"),n=t.$cookies.get("ut"),a=t.$cookies.get("user");"Login"!==t.$router.currentRoute.name&&null!==s&&null!==n&&(t.setToken({secret:s,token:n}),K(a).then((function(e){0===e.result.length&&t.setFirstLogin(!0)})).then((function(){return t.setCurrentUserID(a)})).then((function(e){console.log(e),t.pageConfig.forEach((function(t){t.show=t.access.indexOf(e.result.type)>=0})),t.prepared=!0,t.$forceUpdate()}))),console.log(!t.isLogin,"Login"!==t.$router.currentRoute.name),t.isLogin||"Login"===t.$router.currentRoute.name?"Login"===t.$router.currentRoute.name&&(t.prepared=!0):(console.log("login"),t.$router.push("/login"),t.prepared=!0)}},tt=Z,et=(s("5c0b"),s("2877")),st=Object(et["a"])(tt,d,f,!1,null,null,null),nt=st.exports,at=(s("ddb8"),s("8c4f")),it=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"login"},[s("div",{staticClass:"login-form"},[s("div",{staticClass:"logo"},[t._v(t._s(t.$t("system.name")))]),s("div",{staticClass:"input-area"},[t.accountMode?[s("div",{staticClass:"login-row"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.account,expression:"account"}],attrs:{placeholder:t.$t("general.account")},domProps:{value:t.account},on:{input:function(e){e.target.composing||(t.account=e.target.value)}}})]),s("div",{staticClass:"login-row"},[t.showPassword?s("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{name:"password",placeholder:t.$t("general.password")},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}):s("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",name:"password",placeholder:t.$t("general.password")},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),s("div",{staticClass:"toggle-password"},[t.showPassword?s("icon",{attrs:{"icon-type":"hide_password",size:16},on:{click:function(e){t.showPassword=!1}}}):s("icon",{attrs:{"icon-type":"show_password",size:16},on:{click:function(e){t.showPassword=!0}}})],1)]),""!==t.errMsg?s("div",{staticClass:"login-row"},[s("div",{staticClass:"error-msg"},[t._v(t._s(t.errMsg))])]):t._e(),s("div",{staticClass:"login-row"},[s("dropdown-select",{attrs:{options:t.languageOptions},on:{input:t.changeLocale},model:{value:t.language,callback:function(e){t.language=e},expression:"language"}})],1),s("div",{staticClass:"login-row operation"},[s("text-button",{staticClass:"login-btn",attrs:{"button-type":"primary"},on:{click:t.doLogin}},[t._v(t._s(t.$t("general.login")))]),s("text-button",{on:{click:t.cancel}},[t._v(t._s(t.$t("general.cancel")))])],1)]:[s("div",{staticClass:"login-row"},[s("img",{staticClass:"fido-login",attrs:{src:t.imgSrc},on:{click:t.loginWithFIDO}})]),s("div",{staticClass:"login-row"},[s("dropdown-select",{staticClass:"lang-selector",attrs:{options:t.languageOptions},on:{input:t.changeLocale},model:{value:t.language,callback:function(e){t.language=e},expression:"language"}})],1),s("div",{staticClass:"login-row"},[s("div",{staticClass:"text-link",on:{click:function(e){t.accountMode=!0}}},[t._v(t._s(t.$t("user.login_with_account")))])])]],2)])])},rt=[],ot=s("3835"),ct=(s("5cc6"),s("9a8c"),s("a975"),s("735e"),s("c1ac"),s("d139"),s("3a7b"),s("d5d6"),s("20bf"),s("82f8"),s("e91f"),s("60bd"),s("5f96"),s("3280"),s("3fcc"),s("ca91"),s("25a1"),s("cd26"),s("3c5d"),s("2954"),s("649e"),s("219c"),s("170b"),s("b39a"),s("72f7"),window.location.hostname||"localhost");function lt(t){return Uint8Array.from(t,(function(t){return t.charCodeAt(0)})).buffer}function ut(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function dt(t){return Uint8Array.from(atob(t),(function(t){return t.charCodeAt(0)}))}function ft(t){if(t&&0!==t.byteLength)return btoa(String.fromCharCode.apply(null,new Uint8Array(t)))}function pt(t,e,s,n,a){for(var i=Uint8Array.from(t,(function(t){return t.charCodeAt(0)})),r=0;r<a.length;r+=1)a[r].id=dt(a[r].id);var o={challenge:lt(n),rp:{name:"Students Attendance System",id:ct},user:{id:i,name:e,displayName:s},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"cross-platform",userVerification:"preferred",requireResidentKey:!0},timeout:6e4,excludeCredentials:a,attestation:"direct"};return navigator.credentials.create({publicKey:o,userVerification:"preferred"}).then((function(t){return{id:t.id,clientDataJSON:ut(t.response.clientDataJSON),attestationObject:ft(t.response.attestationObject),metadata:{rpId:o.rp.id,userName:o.user.name,residentKey:o.authenticatorSelection.requireResidentKey}}}))}function vt(){return F().then((function(t){var e=t.result,s={challenge:lt(e),timeout:18e4,allowCredentials:[],userVerification:"discouraged"};return navigator.credentials.get({publicKey:s}).then((function(t){return{id:ft(t.rawId),clientDataJSON:ut(t.response.clientDataJSON),userHandle:ft(t.response.userHandle),signature:ft(t.response.signature),authenticatorData:ft(t.response.authenticatorData),metadata:{rpId:s.rpId}}}))}))}var mt=s("d308"),_t=s.n(mt),gt={data:function(){return{imgSrc:_t.a,accountMode:!1,errMsg:"",account:"",password:"",languageOptions:[{text:"English",value:"en"},{text:"Japanese",value:"jp"}],showPassword:!1,language:["en"]}},methods:Object(p["a"])(Object(p["a"])(Object(p["a"])({},Object(v["b"])(["setCurrentUserID"])),Object(v["d"])(["setToken","setPage","setFirstLogin"])),{},{changeLocale:function(t){if(t.length){var e=Object(ot["a"])(t,1);this.$i18n.locale=e[0],localStorage.setItem("locale",this.$i18n.locale)}},cancel:function(){this.accountMode=!1,this.account="",this.password=""},loginWithFIDO:function(){var t=this;vt().then((function(e){return t.$startLoading(),S(e)})).then((function(e){return t.setCurrentUserID(e.result.uid)})).then((function(e){return t.setTokenFromCookie(),t.$cookies.set("user",e.result.id),t.$router.push("/classes"),P(e.result.id)})).catch((function(e){t.$notify({group:"attendance",title:t.$t("error.login_fail"),type:"error",text:t.$t("error.".concat(e.response.data.error))})})).finally((function(){t.$endLoading()}))},doLogin:function(){var t=this;t.$startLoading();var e=!1;N(t.account,t.password).then((function(s){return e=s.result.isFirstLogin,t.setCurrentUserID(s.result.uid)})).then((function(s){t.$endLoading(),t.setTokenFromCookie(),t.$cookies.set("user",s.result.id),e?(t.setFirstLogin(!0),t.$router.push({name:"ChangePassword"})):t.$router.push("/classes")})).catch((function(e){"user_not_allowed_auth"===e.response.data.error?t.$notify({group:"attendance",title:t.$t("general.login_fail"),type:"error",text:t.$t("error.".concat(e.response.data.error))}):t.$notify({group:"attendance",title:t.$t("error.login_fail"),type:"error"}),t.$endLoading()}))},setTokenFromCookie:function(){var t=this.$cookies.get("sd"),e=this.$cookies.get("ut");this.setToken({secret:t,token:e})}}),mounted:function(){this.setToken({secret:"",token:""}),this.language=[this.$i18n.locale]}},ht=gt,yt=(s("b7b4"),Object(et["a"])(ht,it,rt,!1,null,"9091d5b4",null)),$t=yt.exports,Ct=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"classes"},[s("div",{staticClass:"title row"},[t._v(t._s(t.$t("page.classes")))]),s("div",{staticClass:"row"},[t.userInfo&&2!==t.userInfo.type?s("text-button",{attrs:{"button-type":"primary"},on:{click:t.addClass}},[t._v(t._s(t.$t("class.add_class")))]):t._e(),t.userInfo&&0===t.userInfo.type?s("text-button",{attrs:{"button-type":"primary"},on:{click:t.importClass}},[t._v(t._s(t.$t("general.import")))]):t._e()],1),s("div",{staticClass:"block"},[s("div",{staticClass:"table"},[s("div",{staticClass:"t-row header"},[t._l(t.headers,(function(e){return s("div",{staticClass:"t-cell sortable",class:e.class,on:{click:function(s){return t.sort(e)}}},[s("div",{staticClass:"tr-title"},[t._v(t._s(t.$t(e.labelKey)))]),s("div",{staticClass:"tr-sort"},[void 0===e.sorting?[t._v("⇅")]:e.sorting?[t._v("↓")]:[t._v("↑")]],2)])})),s("div",{staticClass:"t-cell late_time"},[t._v(t._s(t.$t("class.lateAfter")))]),s("div",{staticClass:"t-cell absent_time"},[t._v(t._s(t.$t("class.absenceAfter")))]),s("div",{staticClass:"t-cell actions"},[t._v(t._s(t.$t("general.actions")))])],2),t._l(t.classes,(function(e){return s("div",{key:e.no,staticClass:"t-row"},[s("div",{staticClass:"t-cell category"},[t._v(t._s(e.category))]),s("div",{staticClass:"t-cell campus"},[t._v(t._s(e.campusName))]),s("div",{staticClass:"t-cell day"},[t._v(t._s(e.day))]),s("div",{staticClass:"t-cell period"},[t._v(t._s(e.showPeriod))]),s("div",{staticClass:"t-cell no"},[s("span",[t._v(t._s(e.id))])]),s("div",{staticClass:"t-cell name"},[t._v(t._s(e.name))]),s("div",{staticClass:"t-cell teacher"},[t._v(t._s(e.teacherName))]),s("div",{staticClass:"t-cell late_time"},[t._v(t._s(e.lateAfter))]),s("div",{staticClass:"t-cell absent_time"},[t._v(t._s(e.absenceAfter))]),s("div",{staticClass:"t-cell actions"},[s("div",{staticClass:"text-link",on:{click:function(s){return t.$router.push("/class/"+e.id)}}},[t._v(t._s(t.$t("general.view")))]),t.userInfo&&2!==t.userInfo.type?s("div",{staticClass:"text-link danger",on:{click:function(s){return t.popDeleteClass(e)}}},[t._v(t._s(t.$t("general.delete")))]):t._e()])])}))],2)])])},wt=[];s("d81d"),s("25f0");function kt(t){return t>=10?t.toString():"0".concat(t)}function bt(t){var e=new Date(t);if(isNaN(e.getTime()))return"";var s=kt(e.getMonth()+1),n=kt(e.getDate()),a=kt(e.getHours()),i=kt(e.getMinutes()),r=kt(e.getSeconds());return"".concat(e.getFullYear(),"/").concat(s,"/").concat(n," ").concat(a,":").concat(i,":").concat(r)}function xt(t){var e=kt(t.getMonth()+1),s=kt(t.getDate());return"".concat(t.getFullYear()).concat(e).concat(s)}var Et=["general.sunday","general.monday","general.tuesday","general.wednesday","general.thursday","general.friday","general.saturday"];function It(t){return Et[t]}var Ot=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"file-form"},[s("div",{staticClass:"title"},[t._v(t._s(t.$t("file.choose_import_file")))]),s("div",{staticClass:"row"},[s("text-button",{on:{click:t.showSelectFile}},[t._v(t._s(t.$t("file.select_csv")))]),s("div",{staticClass:"file-name"},[t._v(t._s(t.fileName))]),s("input",{ref:"fileSelector",attrs:{type:"file",hidden:""},on:{change:t.chooseFile}})],1),t.showErr?s("div",{staticClass:"row"},[s("div",{staticClass:"error"},[t._v(t._s(t.$t("file.err_csv_file_not_choose")))])]):t._e()])},St=[],Nt={name:"FileForm",data:function(){return{file:void 0,showErr:!1,fileName:""}},methods:{showSelectFile:function(){this.$refs.fileSelector.click()},chooseFile:function(t){var e=this;if(console.log(t.target.files),t.target.files.length>0){var s=t.target.files[0].name;e.fileName="Loading file...";var n=new FileReader;n.addEventListener("load",(function(t){e.file=new File([t.target.result],s,{type:"text/csv"}),e.fileName=s})),n.readAsText(t.target.files[0])}},validate:function(){void 0!==this.file?this.$emit("validateSuccess",this.file):this.showErr=!0}},mounted:function(){this.$on("validate",this.validate)}},Lt=Nt,Pt=(s("7926"),Object(et["a"])(Lt,Ot,St,!1,null,"c35b55b8",null)),Mt=Pt.exports,Tt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"check"},[t._v(t._s(t.msg))])},Ut=[],jt={props:{extData:{type:Object,required:!0}},computed:{msg:function(){return this.extData?this.extData.msg:""}}},Dt=jt,Kt=(s("0d49"),Object(et["a"])(Dt,Tt,Ut,!1,null,"1591f2b9",null)),At=Kt.exports,Ft={data:function(){return{classes:[],headers:[{labelKey:"class.category",class:"category",key:"category",sorting:void 0},{labelKey:"class.campusName",class:"campus",key:"campusName",sorting:void 0},{labelKey:"class.day",class:"day",key:"day",sorting:void 0},{labelKey:"class.period",class:"period",key:"showPeriod",sorting:void 0},{labelKey:"class.class_no",class:"no",key:"id",sorting:void 0},{labelKey:"class.name",class:"name",key:"name",sorting:void 0},{labelKey:"class.teacherName",class:"teacher",key:"teacherName",sorting:void 0}]}},computed:Object(p["a"])({},Object(v["e"])(["userInfo"])),methods:{sort:function(t){var e=this;void 0!==t.sorting?t.sorting=!t.sorting:t.sorting=!0,e.headers.forEach((function(e){e!==t&&(e.sorting=void 0)}));var s=JSON.parse(JSON.stringify(e.classes));s.sort((function(e,s){var n=t.sorting?1:-1;return e[t.key]>s[t.key]?n:-1*n})),e.classes=s,e.$forceUpdate()},importClass:function(){var t=this;t.$root.$emit("pop-window",{component:Mt,ok_msg:t.$t("general.upload"),cancel_msg:t.$t("general.cancel"),callback:{ok:function(e){t.$startLoading(),X(e).then((function(e){console.log(e);var s=e.result.total,n=e.result.fail,a=0===n?"class.import_success_msg":"class.import_fail_msg";t.$notify({group:"attendance",title:0===n?t.$t("general.success"):t.$t("general.result"),type:0===n?"success":"warn",text:t.$t(a,{total:s,fail:n})})})).catch((function(e){var s=t.$te("error.".concat(e.response.data.error));t.$notify({group:"attendance",title:t.$t("general.update_fail"),type:"error",text:s?t.$t("error.".concat(e.response.data.error)):e.response.data.error})})).finally((function(){t.$endLoading(),t.loadClasses()}))}},title:t.$t("class.import_class"),validate:!0,clickOutsideClose:!1})},popDeleteClass:function(t){console.log(t);var e=this,s=e.$t("class.delete_class_msg",{name:t.name});e.$root.$emit("pop-window",{component:At,ok_msg:e.$t("general.delete"),cancel_msg:e.$t("general.cancel"),extData:{msg:s},callback:{ok:function(){console.log("ok"),b(t.id).then((function(){e.$notify({group:"attendance",title:e.$t("general.delete_success"),type:"success"})})).finally((function(){e.loadClasses()}))}},title:e.$t("class.delete_class"),validate:!1,clickOutsideClose:!1})},addClass:function(){var t=this;t.$router.push({name:"NewClass",params:{id:""}})},loadClasses:function(){var t=this,e=[];t.$startLoading(),y().then((function(s){e=s.result.map((function(e){return Object(p["a"])(Object(p["a"])({},e),{},{day:t.$t(It(e.date))})})),e.forEach((function(t){t.actions=["view","delete"]}))})).then((function(){return x().then((function(t){var s=t.result,n={};s.forEach((function(t){n[t.name]=t})),e.forEach((function(t){var e=n[t.campusName],s=e.periods[t.period-1];t.showCampus=e.name,t.showPeriod="".concat(t.period," - ").concat(kt(s.start_time.hour),":").concat(kt(s.start_time.minute))}))})).catch((function(){console.log("Get campus info fail"),e.forEach((function(t){t.showCampus=t.campusName,t.showPeriod=t.period}))}))})).then((function(){t.classes=e})).finally((function(){t.$endLoading()}))}},mounted:function(){this.loadClasses()}},Ht=Ft,Jt=(s("5f23"),Object(et["a"])(Ht,Ct,wt,!1,null,"01fa3224",null)),Rt=Jt.exports,Bt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"class"},[s("div",{staticClass:"title row"},[s("span",{staticClass:"click-button link",on:{click:t.goClasses}},[t._v(t._s(t.$t("page.classes")))]),s("div",{staticClass:"seperator"}),s("span",[t._v(t._s(t.id)+" "+t._s(t.info.name))])]),s("div",{staticClass:"row"},[s("text-button",{on:{click:function(e){return t.gotoList()}}},[t._v(t._s(t.$t("general.back_list")))]),t.userInfo&&1===t.userInfo.type?s("text-button",{attrs:{"button-type":"primary"},on:{click:t.goSignIn}},[t._v(t._s(t.$t("signin.start_sign_in")))]):t._e()],1),s("div",{staticClass:"block"},[s("div",{staticClass:"session"},[s("div",{staticClass:"session-title"},[s("span",[t._v(t._s(t.$t("class.class_information")))]),t.userInfo&&2!==t.userInfo.type?s("icon",{staticClass:"click-button",attrs:{"icon-type":"edit",size:20},on:{click:t.editClass}}):t._e()],1),s("div",{staticClass:"information"},t._l(t.showKeys,(function(e){return s("div",{key:e,staticClass:"info-row"},[s("div",{staticClass:"name"},[t._v(t._s(t.$t("class."+e)))]),s("div",{staticClass:"value"},[s("span",[t._v(t._s(t.showInfo[e]))]),"lateAfter"===e||"absenceAfter"===e?s("span",{staticClass:"mr-l-8"},[[t._v(t._s(t.$t("general.min")))]],2):t._e()])])})),0)]),s("div",{staticClass:"session"},[s("div",{staticClass:"session-title"},[t._v(t._s(t.$t("general.students")))]),s("div",{staticClass:"attend-students"},t._l(t.students,(function(e){return s("div",{staticClass:"student"},[s("div",{staticClass:"name"},[t._v(t._s(e.username))]),s("div",{staticClass:"id"},[t._v("- "+t._s(e.id))])])})),0),s("div",{staticClass:"operation"},[t.userInfo&&2!==t.userInfo.type?s("text-button",{on:{click:t.editStudents}},[t._v(t._s(t.$t("general.edit")))]):t._e()],1)]),s("div",{staticClass:"session session-table"},[s("div",{staticClass:"session-title"},[t._v(t._s(t.$t("class.sign_record")))]),!t.editMode&&t.userInfo&&2!==t.userInfo.type?s("label-switch",{attrs:{options:t.modeOptions},model:{value:t.mode,callback:function(e){t.mode=e},expression:"mode"}}):t._e(),"date"===t.mode?s("div",{staticClass:"table"},[s("div",{staticClass:"t-header"},[s("div",{staticClass:"t-row header"},[s("div",{staticClass:"t-cell name"},[t._v(t._s(t.$t("class.sign_session")))]),s("div",{staticClass:"t-cell start"},[t._v(t._s(t.$t("class.sign_start_time")))]),s("div",{staticClass:"t-cell count"},[t._v(t._s(t.$t("class.sign_students")))]),s("div",{staticClass:"t-cell actions"},[t._v(t._s(t.$t("general.actions")))])])]),s("div",{staticClass:"t-body"},[t._l(t.sessions,(function(e){return[s("div",{key:e.start_time,staticClass:"t-row"},[s("div",{staticClass:"t-cell name"},[t._v(t._s(e.name))]),s("div",{staticClass:"t-cell start"},[t._v(t._s(e.start_time))]),s("div",{staticClass:"t-cell count"},[t._v(t._s(e.count))]),s("div",{staticClass:"t-cell actions"},[t.editMode?t._e():[s("div",{staticClass:"text-link",on:{click:function(s){return t.expandRow(e)}}},[t._v(t._s(t.$t("general.detail")))]),""===e.end_time&&t.userInfo&&1===t.userInfo.type?s("div",{staticClass:"text-link",on:{click:function(s){return t.continueSession(e)}}},[t._v(t._s(t.$t("general.continue")))]):t._e(),s("div",{staticClass:"text-link",on:{click:function(s){return t.exportSession(e)}}},[t._v(t._s(t.$t("general.export")))]),""===e.end_time&&t.userInfo&&2===t.userInfo.type?s("div",{staticClass:"text-link",on:{click:function(s){return t.startFIDO(e)}}},[t._v(t._s(t.$t("signin.start_fido")))]):t._e()]],2)]),s("transition",{key:e.start_time,attrs:{"enter-active-class":"fade-enter-active","leave-active-class":"fade-leave-active"}},[e.expand?s("div",{key:e.start_time,staticClass:"t-expand"},[e.expand&&t.userInfo&&1===t.userInfo.type?s("div",{staticClass:"operation-row"},[t.editMode?s("text-button",{attrs:{"button-type":"primary"},on:{click:t.endEdit}},[s("span",[t._v(t._s(t.$t("class.end_edit_status")))])]):s("text-button",{on:{click:function(s){return t.startEdit(e)}}},[s("span",[t._v(t._s(t.$t("class.edit_status")))])])],1):t._e(),s("div",{staticClass:"students"},t._l(e.students,(function(e){return s("div",{key:e.name,staticClass:"student",class:{editing:t.editMode}},[s("div",{staticClass:"student-name"},[t._v(t._s(e.name))]),s("div",{staticClass:"student-id"},[t._v(t._s(e.id))]),t.editMode?t._e():s("div",{staticClass:"student-status attend-status",class:{attend:0===e.status,late:1===e.status,absent:2===e.status}},[t._v(t._s(e.statusText))]),t.editMode?s("div",{staticClass:"student-status"},[s("status-switch",{on:{change:function(s){return t.updateStatus(e,s)}},model:{value:e.status,callback:function(s){t.$set(e,"status",s)},expression:"student.status"}})],1):t._e()])})),0)]):t._e()])]}))],2)]):t._e(),"student"===t.mode?s("div",{staticClass:"scroll-table"},[s("div",{staticClass:"fixed-column"},[s("div",{staticClass:"column"},[s("div",{staticClass:"t-cell"},[t._v(t._s(t.$t("general.student")))]),t._l(t.students,(function(e){return s("div",{staticClass:"t-cell"},[t._v(t._s(e.username))])}))],2),s("div",{staticClass:"column"},[s("div",{staticClass:"t-cell"},[t._v(t._s(t.$t("general.id")))]),t._l(t.students,(function(e){return s("div",{staticClass:"t-cell"},[t._v(t._s(e.id))])}))],2)]),s("div",{staticClass:"scroll-column"},[t._l(t.times,(function(e){return s("div",{key:e.start,staticClass:"column"},[s("div",{staticClass:"t-cell"},[t._v(t._s(e.name))]),t._l(t.students,(function(n){return s("div",{key:n.id,staticClass:"t-cell"},[void 0!==t.studentAttendMap[n.id][e.start]?[s("span",{staticClass:"attend-status",class:{attend:0===t.studentAttendMap[n.id][e.start].status,late:1===t.studentAttendMap[n.id][e.start].status,absent:2===t.studentAttendMap[n.id][e.start].status}},[t._v(t._s(t.studentAttendMap[n.id][e.start].text))])]:[s("span",{staticClass:"attend-status absent"},[t._v(t._s(t.$t("signin.absent")))])]],2)}))],2)})),s("div",{staticClass:"column stretch"},[s("div",{staticClass:"t-cell"}),t._l(t.students,(function(t){return s("div",{key:t.id,staticClass:"t-cell"})}))],2)],2)]):t._e(),t.totalPage>1?s("paginate",{attrs:{"page-count":t.totalPage,"prev-text":"Prev","next-text":"Next","click-handler":t.loadSessionPage,"container-class":"pagination","page-class":"page-item"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}):t._e()],1)])])},qt=[],zt=(s("4de4"),s("c740"),s("b64b"),s("ac1f"),s("1276"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"label-switch"},[t._l(t.options,(function(e){return[s("div",{key:e.val,staticClass:"option",class:{selected:e.val===t.selectedVal},style:t.calculateStyle(e),on:{click:function(s){return t.clickOnOption(e)}}},[t._v(" "+t._s(e.text)+" ")])]}))],2)}),Vt=[],Wt={name:"label-switch",props:{value:{required:!1,default:void 0,validator:function(t){return"number"===typeof t||"string"===typeof t}},default:{required:!1,default:void 0,validator:function(t){return"number"===typeof t||"string"===typeof t}}},watch:{value:function(t){this.selectedVal=t}},data:function(){return{selectedVal:void 0,options:[]}},methods:{clickOnOption:function(t){this.selectedVal=t.val,this.$emit("change",t.val),this.$emit("input",t.val)},calculateStyle:function(t){return t.val===this.selectedVal?{background:t.background||"black",color:t.color||"white"}:{}}},mounted:function(){this.options=[{val:0,text:this.$t("signin.attend"),background:"#666666",color:"white"},{val:1,text:this.$t("signin.late"),background:"#f68c6d ",color:"white"},{val:2,text:this.$t("signin.absent"),background:"#fd0008",color:"white"}],this.selectedVal=this.value||this.default||this.options[0].val}},Yt=Wt,Gt=(s("b5d0"),Object(et["a"])(Yt,zt,Vt,!1,null,"76186e39",null)),Qt=Gt.exports,Xt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"students-form"},[s("div",{staticClass:"operation"},[s("dropdown-select",{attrs:{options:t.users,width:"150px","fixed-list-width":""},model:{value:t.newStudent,callback:function(e){t.newStudent=e},expression:"newStudent"}}),s("text-button",{attrs:{"button-type":t.canAdd?"":"disable"},on:{click:t.addStudent}},[t._v(t._s(t.$t("general.add")))])],1),s("div",{staticClass:"students"},[s("div",{staticClass:"title"},[t._v(t._s(t.$t("class.attend_students")))]),t.students.length>0?s("div",{staticClass:"list"},t._l(t.students,(function(e,n){return s("div",{staticClass:"student"},[s("div",{staticClass:"name"},[t._v(t._s(e.username))]),s("div",{staticClass:"id"},[t._v("- "+t._s(e.id))]),s("div",{staticClass:"delete",on:{click:function(e){return t.removeStudent(n)}}},[t._v("x")])])})),0):s("div",{staticClass:"list"},[t._v(t._s(t.$t("class.no_students")))])])])},Zt=[],te=(s("a434"),{props:{extData:{type:Object,required:!0}},data:function(){return{students:[],newStudent:[],allUsers:[],usersMap:{},users:[]}},computed:{canAdd:function(){return this.newStudent.length>0}},methods:{validate:function(){this.$emit("validateSuccess",this.students)},addStudent:function(){var t=this.newStudent[0],e=this.usersMap[t];this.students.push({id:e.id,username:e.username}),this.newStudent=[],this.calculateUsers()},removeStudent:function(t){this.students.splice(t,1),this.calculateUsers(),this.$forceUpdate()},loadUsers:function(){var t=this;L().then((function(e){var s=[];t.usersMap={},e.result.forEach((function(e){2===e.type&&(s.push({text:e.username,value:e.id}),t.usersMap[e.id]=e)})),t.allUsers=s,t.calculateUsers()}))},calculateUsers:function(){var t={};this.students.forEach((function(e){t[e.id]=!0})),console.log(t),this.users=this.allUsers.filter((function(e){return!t[e.value]}))}},mounted:function(){var t=this;console.log(t.extData),t.students=t.extData.students,t.$on("validate",(function(){t.validate()})),t.loadUsers()}}),ee=te,se=(s("f1d1"),Object(et["a"])(ee,Xt,Zt,!1,null,"4a8b92e4",null)),ne=se.exports,ae=s("0f35"),ie={0:"signin.attend",1:"signin.late",2:"signin.absent"};function re(){var t=window.location.href,e=t.split("?");if(e.length<2)return{};var s=e[1].split("&"),n={};return s.forEach((function(t){var e=t.split("=");e.length<2?n[e[0]]="":n[e[0]]=e[1]})),n}var oe={props:{id:{type:String}},components:{"status-switch":Qt},data:function(){return{info:{},showInfo:{},showKeys:["class_no","campusName","category","period","name","lateAfter","day","absenceAfter","teacherName"],editMode:!1,editSession:void 0,mode:"date",modeOptions:[{val:"date",text:this.$t("class.group_by_date")},{val:"student",text:this.$t("class.group_by_student")}],sessions:[],students:[],times:[],studentIDMap:{},studentAttendMap:{},studentMap:{},pageLimit:10,totalPage:1,currentPage:1,expandSessionID:void 0}},computed:Object(p["a"])({},Object(v["e"])(["userInfo"])),methods:{exportSession:function(t){console.log(t);var e="\ufeffID, Name, Status\n";t.students.forEach((function(t){e+="".concat(t.id,",").concat(t.name,",").concat(t.statusText,"\n")}));var s=new Blob([e],{type:"text/csv"});ae["a"].downloadRawFile(s,"".concat(this.id,"_").concat(t.name,".csv"))},editClass:function(){this.$router.push({name:"EditClass",params:{id:this.id}})},goClasses:function(){this.$router.push({name:"Classes"})},updateStatus:function(t,e){var s=this;console.log(t,e);var n={status:e,student:t.id,session:this.editSession.title};q(this.id,[n]).then((function(){s.$notify({group:"attendance",title:s.$t("general.update_success"),type:"success"}),t.statusText=s.$t(ie[e])})).catch((function(t){s.$notify({group:"attendance",title:s.$t("general.update_fail"),type:"warn",text:s.$t("error.".concat(t.response.data.message))})}))},expandRow:function(t){this.sessions.forEach((function(t){t.expand=!1})),t.expand=!0,this.expandSessionID=t.title},continueSession:function(t){console.log(t),this.$router.push("/class/".concat(this.id,"/signin/").concat(t.title,"?start=").concat(t.start))},formatSessions:function(t){var e=this;e.studentAttendMap={},e.students.forEach((function(t){e.studentAttendMap[t.id]={}})),e.times=[],e.sessions=t.map((function(t){var s=new Date(parseInt(t.start,10)),n=new Date(parseInt(t.end,10)),a={};t.records.forEach((function(t){(void 0===a[t.student]||0!==t.time&&(0===a[t.student].time||a[t.student].time>t.time))&&(a[t.student]=t)}));var i=xt(s),r=[];if(2===e.userInfo.type){var o=a[e.userInfo.id]?a[e.userInfo.id].status:2,c=e.$t(ie[o]);2===o&&void 0!==a[e.userInfo.id]&&0!==a[e.userInfo.id].time&&(c=e.$t("signin.signed_but_absent")),r=[{name:e.userInfo.name,id:e.userInfo.id,time:a[e.userInfo.id]?bt(new Date(a[e.userInfo.id].time)).substr(11,5):"",status:o,statusText:c}]}else r=JSON.parse(JSON.stringify(e.students)).map((function(t){var s=a[t.id]?a[t.id].status:2,n=e.$t(ie[s]);return 2===s&&void 0!==a[t.id]&&0!==a[t.id].time&&(n=e.$t("signin.signed_but_absent")),{name:t.username,id:t.id,time:a[t.id]?bt(new Date(a[t.id].time)).substr(11,5):"",status:s,statusText:n}}));return Object.keys(a).forEach((function(s){if(e.studentAttendMap[s]){var n=e.$t(ie[a[s].status]);2===a[s].status&&void 0!==a[s]&&0!==a[s].time&&(n=e.$t("signin.signed_but_absent")),e.studentAttendMap[s][t.start]={status:a[s].status,text:n}}})),e.times.push({start:t.start,name:i}),{name:i,start_time:bt(s),start:t.start,end_time:bt(n),title:t.title,count:Object.keys(a).filter((function(t){return 0!==a[t].time})).length,expand:t.title===e.expandSessionID,students:r}})),e.$forceUpdate()},gotoList:function(){this.$router.push({name:"Classes"})},startEdit:function(t){this.editMode=!0,this.editSession=t},endEdit:function(){this.editMode=!1,this.editSession=void 0,this.loadSessionPage()},editStudents:function(){var t=this,e=this;this.$root.$emit("pop-window",{component:ne,ok_msg:e.$t("general.save"),cancel_msg:e.$t("general.cancel"),extData:{students:JSON.parse(JSON.stringify(e.info.students))},callback:{ok:function(s){console.log(s),e.updateStudents(s).then((function(){t.$notify({group:"attendance",title:t.$t("general.update_success"),type:"success"}),e.reload()})).catch((function(e){t.$notify({group:"attendance",title:t.$t("general.update_fail"),type:"warn",text:t.$t("error.".concat(e.response.data.message))})}))}},title:e.$t("class.edit_students"),validate:!0})},updateStudents:function(t){return B(this.id,t)},goSignIn:function(){var t=this,e=this;z(e.id).then((function(e){t.$router.push("/class/".concat(t.id,"/signin/").concat(e.result.title))}))},loadSessionPage:function(t){console.log(t);var e=this,s=(t-1)*e.pageLimit;return Y(e.id,e.pageLimit,s).then((function(t){e.totalPage=parseInt((t.result.total-1)/e.pageLimit,10)+1,e.formatSessions(t.result.records)}))},reload:function(){var t=this;return t.$startLoading(),C(t.id).then((function(e){t.info=e.result,t.showInfo=JSON.parse(JSON.stringify(e.result)),t.students=t.info.students,delete t.showInfo.id,delete t.showInfo.teacherId,delete t.showInfo.students,t.showInfo.day=t.$t(It(t.showInfo.date))})).then((function(){return x()})).then((function(e){var s=e.result,n={};s.forEach((function(t){n[t.name]=t}));var a=n[t.info.campusName],i=a.periods[t.info.period-1];t.showInfo.campusName=a.name,t.showInfo.period="".concat(t.info.period," ( ").concat(kt(i.start_time.hour),":").concat(kt(i.start_time.minute)," )")})).then((function(){return L()})).then((function(e){t.studentMap={},e.result.forEach((function(e){2===e.type&&(t.studentMap[e.id]=e)}))})).then((function(){return t.loadSessionPage(t.currentPage)})).finally((function(){t.$endLoading()}))},startFIDO:function(t){var e=this;return e.getSessionIsEnd(t).then((function(s){return console.log(s),s?(e.$notify({group:"attendance",title:e.$t("error.update_fail"),type:"warn",text:e.$t("error.session_is_end")}),e.$router.push("/class/".concat(e.id)),""):vt().then((function(s){return console.log(s),V(e.id,t.title,s).then((function(t){var s=t.result.student,n=t.result.time,a="";e.students.forEach((function(t){t.id===s&&(t.status=0,t.statusText=e.$t("signin.attend"),t.signinTime=bt(n).substr(11,5),a=t.username)})),e.reload(),e.$notify({group:"attendance",title:e.$t("general.success"),type:"success",text:e.$t("signin.signin_user_success",{user:a})})})).catch((function(t){console.log(t.response.data.error),e.$notify({group:"attendance",title:e.$t("error.sign_fail"),type:"warn",text:e.$t("error.".concat(t.response.data.error))})}))}))})).catch((function(t){return console.log(t),e.getSessionIsEnd()})).then((function(t){t&&(e.$notify({group:"attendance",title:e.$t("error.update_fail"),type:"warn",text:e.$t("error.session_is_end")}),e.$router.push("/class/".concat(e.id)))}))},getSessionIsEnd:function(t){var e=this,s=re();console.log(s);var n=t.title.split("_"),a=n[n.length-1]||s.start;return a?Y(e.id,1,0,parseInt(a,10)+1).then((function(e){var s=e.result.records.findIndex((function(e){return e.title===t.title}));return""!==e.result.records[s].end})):new Promise((function(t){return t(!1)}))}},mounted:function(){this.reload()}},ce=oe,le=(s("b71d"),Object(et["a"])(ce,Bt,qt,!1,null,"cb6a43cc",null)),ue=le.exports,de=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"sign-in"},[s("div",{staticClass:"title row"},[t._v(t._s(t.$t("signin.classes"))+" > "+t._s(t.id)+" "+t._s(t.className)+" > "+t._s(t.day||t.$t("signin.sign_in")))]),s("div",{staticClass:"row"},[s("text-button",{on:{click:t.endSignin}},[t._v(t._s(t.$t("signin.end_sign_in")))]),s("text-button",{attrs:{"button-type":"primary"},on:{click:t.startFIDO}},[t._v(t._s(t.$t("signin.start_fido")))])],1),s("div",{staticClass:"block"},[s("div",{staticClass:"title-row"},[s("div",{staticClass:"title"},[t._v(t._s(t.$t("signin.list_of_signed_student")))]),s("div",{staticClass:"link",on:{click:t.openNewWindow}},[t._v(t._s(t.$t("signin.view_in_new_window")))])]),s("div",{staticClass:"list"},[s("div",{staticClass:"info"},[t._v(t._s(t.$t("signin.number_of_student_sign_in",{num:t.attendStudentsCnt})))]),s("div",{staticClass:"students"},t._l(t.students,(function(e,n){return s("div",{key:e.id,staticClass:"student"},[s("div",{staticClass:"name"},[t._v(t._s(e.username)+" ("+t._s(e.id)+")")]),s("div",{staticClass:"bar"}),s("div",{staticClass:"status",class:{absent:2===e.status,late:1===e.status,attend:0===e.status}},[t._v(t._s(e.statusText)),e.signinTime?s("div",{staticClass:"time"},[t._v("("+t._s(e.signinTime)+")")]):t._e()])])})),0)])])])},fe=[];function pe(){var t=window.location.href,e=t.split("?");if(e.length<2)return{};var s=e[1].split("&"),n={};return s.forEach((function(t){var e=t.split("=");e.length<2?n[e[0]]="":n[e[0]]=e[1]})),n}var ve,me={props:{id:{type:String},session:{type:String}},data:function(){return{students:[],newWindow:void 0,attendStudentsCnt:0,className:"",day:""}},computed:{},methods:{startFIDO:function(){var t=this;return t.getSessionIsEnd().then((function(e){return console.log(e),e?(t.$notify({group:"attendance",title:t.$t("error.update_fail"),type:"warn",text:t.$t("error.session_is_end")}),t.$router.push("/class/".concat(t.id)),""):vt().then((function(e){return console.log(e),V(t.id,t.session,e).then((function(e){var s=e.result.student,n=e.result.time,a="";t.students.forEach((function(e){e.id===s&&(e.status=0,e.statusText=t.$t("signin.attend"),e.signinTime=bt(n).substr(11,5),a=e.username)})),t.attendStudentsCnt=t.students.filter((function(t){return void 0!==t.signinTime})).length,t.saveCache(),t.$notify({group:"attendance",title:t.$t("general.success"),type:"success",text:t.$t("signin.signin_user_success",{user:a})}),t.$nextTick((function(){t.$forceUpdate()}))})).catch((function(e){console.log(e.response.data.error),t.$notify({group:"attendance",title:t.$t("error.sign_fail"),type:"warn",text:t.$t("error.".concat(e.response.data.error))})})).then((function(){return t.startFIDO()}))}))})).catch((function(e){return console.log(e),t.getSessionIsEnd()})).then((function(e){e&&(t.$notify({group:"attendance",title:t.$t("error.update_fail"),type:"warn",text:t.$t("error.session_is_end")}),t.$router.push("/class/".concat(t.id)))}))},saveCache:function(){localStorage.setItem("signin_students",JSON.stringify(this.students))},endSignin:function(){var t=this;t.getSessionIsEnd().then((function(e){return console.log(e),e?"":W(t.id,t.session)})).then((function(){t.newWindow&&t.newWindow.close(),localStorage.removeItem("signin_students"),t.$router.push("/class/".concat(t.id))}))},openNewWindow:function(){this.newWindow=window.open("/signin.html","signinpage","menubar=no,location=no,resizable=yes,scrollbars=yes,status=yes,width=500px,height=500px")},getSessionIsEnd:function(){var t=this,e=pe();console.log(e);var s=t.session.split("_"),n=s[s.length-1]||e.start;return n?Y(t.id,1,0,parseInt(n,10)+1).then((function(e){var s=e.result.records.findIndex((function(e){return e.title===t.session}));return""!==e.result.records[s].end})):new Promise((function(t){return t(!1)}))}},mounted:function(){var t=this,e=[];t.$startLoading(),C(t.id).then((function(s){console.log(s),t.className=s.result.name,e=s.result.students,e.forEach((function(e){e.status=2,e.statusText=t.$t("signin.not_sign_in")})),t.attendStudentsCnt=0;var n=pe();console.log(n);var a=t.session.split("_"),i=a[a.length-1]||n.start;return i?Y(t.id,1,0,parseInt(i,10)+1).then((function(e){console.log(e);var s=e.result.records.findIndex((function(e){return e.title===t.session}));return s<0?(t.$router.push("/class/".concat(t.id)),[]):(""!==e.result.records[s].end&&t.$router.push("/class/".concat(t.id)),e.result.records[s].records)})).then((function(s){s.forEach((function(s){var n=e.findIndex((function(t){return t.id===s.student}));console.log(s.student,n),n>=0&&0!==s.time&&(void 0===e[n].time||e[n].time>s.time)&&(e[n].time=s.time,e[n].status=s.status,e[n].statusText=t.$t("signin.attend"),e[n].signinTime=bt(s.time).substr(11,5))})),t.$forceUpdate()})):""})).then((function(){t.students=e,t.attendStudentsCnt=t.students.filter((function(t){return void 0!==t.signinTime})).length})).finally((function(){t.saveCache(),t.$endLoading()}));var s=t.session.split("_"),n=Object(ot["a"])(s,2),a=n[1];t.day=bt(parseInt(a,10)).substr(0,10)}},_e=me,ge=(s("2c29"),Object(et["a"])(_e,de,fe,!1,null,"c9999bc6",null)),he=ge.exports,ye=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"new-class",attrs:{id:"content"}},[t.editMode?t._e():s("div",{staticClass:"title row"},[s("span",{staticClass:"click-button link",on:{click:t.goClasses}},[t._v(" "+t._s(t.$t("page.classes"))+" ")]),s("div",{staticClass:"seperator"}),s("span",[t._v(" "+t._s(t.$t("class.add_class"))+" ")])]),t.editMode?s("div",{staticClass:"title row"},[s("span",{staticClass:"click-button link",on:{click:t.goClasses}},[t._v(" "+t._s(t.$t("page.classes"))+" ")]),s("div",{staticClass:"seperator"}),s("span",{staticClass:"click-button link",on:{click:t.goClass}},[t._v(" "+t._s(t.id)+" ")]),s("div",{staticClass:"seperator"}),t._v(" "+t._s(t.$t("class.edit_class"))+" ")]):t._e(),s("div",{staticClass:"block"},[s("div",{staticClass:"class-form"},[s("div",{staticClass:"form-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("class.category")))]),s("info-input",{attrs:{msg:t.$t("class.info_category"),fill:""},on:{blur:function(e){return t.checkError(t.category)}},model:{value:t.category,callback:function(e){t.category=e},expression:"category"}})],1),""!==t.categoryErr?s("div",{staticClass:"form-row error"},[s("div",{staticClass:"label"}),s("div",[t._v(t._s(t.categoryErr))])]):t._e(),s("div",{staticClass:"form-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("class.class_no")))]),s("info-input",{attrs:{msg:t.$t("class.info_no"),fill:"",disabled:t.editMode},on:{blur:function(e){return t.checkError(t.no)}},model:{value:t.no,callback:function(e){t.no=e},expression:"no"}})],1),""!==t.classNoErr?s("div",{staticClass:"form-row error"},[s("div",{staticClass:"label"}),s("div",[t._v(t._s(t.classNoErr))])]):t._e(),s("div",{staticClass:"form-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("class.name")))]),s("info-input",{attrs:{msg:t.$t("class.info_name"),fill:""},on:{blur:function(e){return t.checkError(t.name)}},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),""!==t.nameErr?s("div",{staticClass:"form-row error"},[s("div",{staticClass:"label"}),s("div",[t._v(t._s(t.nameErr))])]):t._e(),s("div",{staticClass:"form-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("class.campusName")))]),s("dropdown-select",{attrs:{options:t.campuses,width:"150px","fixed-list-width":""},model:{value:t.campus,callback:function(e){t.campus=e},expression:"campus"}})],1),""!==t.campusErr?s("div",{staticClass:"form-row error"},[s("div",{staticClass:"label"}),s("div",[t._v(t._s(t.campusErr))])]):t._e(),s("div",{staticClass:"form-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("class.day")))]),s("dropdown-select",{attrs:{options:t.dates,width:"150px","fixed-list-width":""},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1),""!==t.dateErr?s("div",{staticClass:"form-row error"},[s("div",{staticClass:"label"}),s("div",[t._v(t._s(t.dateErr))])]):t._e(),s("div",{staticClass:"form-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("class.period")))]),s("dropdown-select",{attrs:{options:t.periods,disabled:void 0===t.campus,width:"150px","fixed-list-width":""},model:{value:t.period,callback:function(e){t.period=e},expression:"period"}})],1),""!==t.periodErr?s("div",{staticClass:"form-row error"},[s("div",{staticClass:"label"}),s("div",[t._v(t._s(t.periodErr))])]):t._e(),s("div",{staticClass:"form-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("class.teacherName")))]),s("dropdown-select",{attrs:{options:t.teachers,width:"150px","fixed-list-width":""},model:{value:t.teacher,callback:function(e){t.teacher=e},expression:"teacher"}})],1),""!==t.teacherErr?s("div",{staticClass:"form-row error"},[s("div",{staticClass:"label"}),s("div",[t._v(t._s(t.teacherErr))])]):t._e(),s("div",{staticClass:"form-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("class.lateAfter")))]),s("info-input",{attrs:{type:"number",max:t.absentAfter,msg:t.$t("class.info_late_after"),fill:""},model:{value:t.lateAfter,callback:function(e){t.lateAfter=e},expression:"lateAfter"}}),s("div",{staticClass:"rear-label"},[t._v(t._s(t.$t("general.minutes")))])],1),""!==t.lateAfterErr?s("div",{staticClass:"form-row error"},[s("div",{staticClass:"label"}),s("div",[t._v(t._s(t.lateAfterErr))])]):t._e(),s("div",{staticClass:"form-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("class.absenceAfter")))]),s("info-input",{attrs:{type:"number",msg:t.$t("class.info_absent_after"),fill:""},model:{value:t.absentAfter,callback:function(e){t.absentAfter=e},expression:"absentAfter"}}),s("div",{staticClass:"rear-label"},[t._v(t._s(t.$t("general.minutes")))])],1),s("div",{staticClass:"form-row"},[s("text-button",{attrs:{"button-type":"primary"},on:{click:t.saveClass}},[t.editMode?s("span",[t._v(t._s(t.$t("general.save")))]):s("span",[t._v(t._s(t.$t("general.add")))])]),s("text-button",{staticClass:"cancel-btn",on:{click:t.cancel}},[t._v(" "+t._s(t.$t("general.cancel"))+" ")])],1)])])])},$e=[],Ce=(s("7db0"),s("2909")),we=[{id:0,name:"坂戶",periods:[{start_time:{hour:9,minute:10},end_time:{hour:10,minute:0}},{start_time:{hour:10,minute:10},end_time:{hour:11,minute:0}},{start_time:{hour:11,minute:10},end_time:{hour:12,minute:0}},{start_time:{hour:12,minute:10},end_time:{hour:13,minute:0}},{start_time:{hour:13,minute:10},end_time:{hour:14,minute:0}},{start_time:{hour:14,minute:10},end_time:{hour:15,minute:0}}]},{id:1,name:"Campus",periods:[{start_time:{hour:9,minute:10},end_time:{hour:10,minute:0}}]}],ke={props:{id:{required:!1}},data:function(){var t={};return we.forEach((function(e){t[e.id]=e})),{name:"",category:"",no:"",lateAfter:10,absentAfter:15,campusesInfo:t,campus:[],period:void 0,teacher:[],teachers:[],campuses:[],date:[1],dates:[],categoryErr:"",nameErr:"",dateErr:"",campusErr:"",periodErr:"",classNoErr:"",teacherErr:"",timeSetErr:"",lateAfterErr:"",checkData:[{key:"category",errMsgKey:"categoryErr",errKey:"class.categoryEmptyErr"},{key:"no",errMsgKey:"classNoErr",errKey:"class.classNoEmptyErr"},{key:"name",errMsgKey:"nameErr",errKey:"class.nameEmptyErr"},{key:"date",errMsgKey:"dateErr",errKey:"class.dateEmptyErr"},{key:"campus",errMsgKey:"campusErr",errKey:"class.campusEmptyErr"},{key:"period",errMsgKey:"periodErr",errKey:"class.periodEmptyErr"},{key:"teacher",errMsgKey:"teacherErr",errKey:"class.teacherEmptyErr"}],classIsExist:!1}},computed:Object(p["a"])(Object(p["a"])({},Object(v["e"])(["userInfo"])),{},{editMode:function(){return""!==this.id&&this.classIsExist},periods:function(){var t=this,e=this.campuses.findIndex((function(e){return t.campus.length>0&&e.id===t.campus[0]}));return e>=0?this.campuses[e].periods.map((function(t,e){return{text:"".concat(e+1," - ").concat(kt(t.start_time.hour),":").concat(kt(t.start_time.minute)),value:e}})):[]}}),methods:{goClass:function(){this.$router.push({name:"Class",props:{id:this.id}})},goClasses:function(){this.$router.push({name:"Classes"})},checkError:function(t,e){console.log("blur");var s=this,n=!1;return s.checkData.forEach((function(a){if((t===s[a.key]||e)&&(!n||e)){if(Array.isArray(s[a.key])){if(!e)return;if(s[a.key].length<=0)return s[a.errMsgKey]=s.$t(a.errKey),void(n=!0)}if(void 0===s[a.key]){if(!e)return;return s[a.errMsgKey]=s.$t(a.errKey),void(n=!0)}if(""===s[a.key])return s[a.errMsgKey]=s.$t(a.errKey),void(n=!0);if("function"===typeof a.check&&!a.check(s[a.key]))return s[a.errMsgKey]=s.$t(a.errKey),void(n=!0);s[a.errMsgKey]="",console.log(a.key,Array.isArray(s[a.key]),s[a.key])}})),!n},saveClass:function(){var t=this,e=this;if(e.checkError("",!0)){var s={class_no:e.no,name:e.name,category:e.category,date:e.date[0],campus:e.campus[0],campusName:e.campuses.find((function(t){return t.value===e.campus[0]})).text,period:parseInt(e.period[0],10)+1,teacherId:e.teacher[0],teacherName:e.teachers.find((function(t){return t.value===e.teacher[0]})).text,lateAfter:e.lateAfter,absenceAfter:e.absentAfter,students:[]};console.log(s);var n=this.editMode?k(e.no,s):w(s);n.then((function(){t.editMode?e.$router.push({name:"Class",props:{id:t.id}}):e.$router.push({name:"Classes"})})).then((function(){e.$notify({group:"attendance",title:e.$t("general.update_success"),type:"success"})})).catch((function(t){e.$notify({group:"attendance",title:e.$t("class.add_class_fail"),type:"error",text:e.$t("error.".concat(t.response.data.error))})}))}},cancel:function(){this.editMode?this.$router.push({name:"Class",props:{id:this.id}}):this.$router.push({name:"Classes"})},loadUsers:function(){var t=this,e=[];return t.$startLoading(),1===t.userInfo.type&&e.push(JSON.parse(JSON.stringify(t.userInfo))),L().then((function(s){e.push.apply(e,Object(Ce["a"])(s.result.filter((function(t){return"teacher"===t.type||1===t.type})))),t.teachers=e.map((function(t){return{text:t.username||t.name,value:t.id}})),t.teachers.length>0&&(t.teacher=[t.teachers[0].value])})).finally((function(){t.$endLoading()}))},loadData:function(){var t=this,e=[];t.$startLoading();var s=x().then((function(t){e=t.result.map((function(t){return t.text=t.name,t.value=t.id,t}))}));return""!==this.id&&(s=s.then((function(){return C(t.id)})).then((function(s){t.no=s.result.class_no,t.name=s.result.name,t.category=s.result.category,t.date=[s.result.date];var n=e.findIndex((function(t){return t.text===s.result.campusName}));t.campus=[e[n].value],t.period=[s.result.period-1],t.teacher=[s.result.teacherId],t.lateAfter=s.result.lateAfter,t.absentAfter=s.result.absenceAfter,t.classIsExist=!0,t.$nextTick((function(){t.$forceUpdate()}))}))),s=s.then((function(){t.campuses=e})).finally((function(){t.$endLoading()})),s}},mounted:function(){var t=this;console.log("mounted"),this.loadUsers().then((function(){return t.loadData()})),this.dates=[{text:this.$t("general.monday"),value:1},{text:this.$t("general.tuesday"),value:2},{text:this.$t("general.wednesday"),value:3},{text:this.$t("general.thursday"),value:4},{text:this.$t("general.friday"),value:5},{text:this.$t("general.saturday"),value:6},{text:this.$t("general.sunday"),value:0}],this.checkData.push({key:"lateAfter",errMsgKey:"lateAfterErr",errKey:"class.lateAfterBiggerThenAbsentErr",check:function(e){return parseInt(e,10)<=parseInt(t.absentAfter,10)}})}},be=ke,xe=(s("b17f"),Object(et["a"])(be,ye,$e,!1,null,"2717ca40",null)),Ee=xe.exports,Ie=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"users"},[s("div",{staticClass:"title row"},[t._v(t._s(t.$t("page.users")))]),s("div",{staticClass:"row"},[s("text-button",{attrs:{"button-type":"primary"},on:{click:t.addUser}},[t._v(t._s(t.$t("user.add_user_btn")))]),t.userInfo&&0===t.userInfo.type?s("text-button",{attrs:{"button-type":"primary"},on:{click:t.importUsers}},[t._v(t._s(t.$t("general.import")))]):t._e()],1),s("div",{staticClass:"block"},[s("div",{staticClass:"table"},[s("div",{staticClass:"t-row header"},[t._l(t.headers,(function(e){return s("div",{staticClass:"t-cell sortable",class:e.class,on:{click:function(s){return t.sort(e)}}},[s("div",{staticClass:"tr-title"},[t._v(t._s(t.$t(e.labelKey)))]),s("div",{staticClass:"tr-sort"},[void 0===e.sorting?[t._v("⇅")]:e.sorting?[t._v("↓")]:[t._v("↑")]],2)])})),s("div",{staticClass:"t-cell actions"},[t._v(t._s(t.$t("general.actions")))])],2),t._l(t.users,(function(e){return s("div",{key:e.studentID,staticClass:"t-row"},[s("div",{staticClass:"t-cell name"},[t._v(t._s(e.username))]),s("div",{staticClass:"t-cell name"},[t._v(t._s(e.id))]),s("div",{staticClass:"t-cell type"},[void 0!==e.allowAccountLogin?s("span",[t._v(t._s(t.$t("general.admin")))]):1===e.type?s("span",[t._v(t._s(t.$t("general.teacher")))]):2===e.type?s("span",[t._v(t._s(t.$t("general.student")))]):t._e()]),s("div",{staticClass:"t-cell actions"},[s("div",{staticClass:"text-link",on:{click:function(s){return t.$router.push("/user/"+e.id)}}},[t._v(t._s(t.$t("general.view")))]),"admin"!==e.type&&0!==e.type?s("div",{staticClass:"text-link danger",on:{click:function(s){return t.popDeleteUser(e)}}},[s("span",[t._v(t._s(t.$t("general.delete")))])]):t._e()])])}))],2)])])},Oe=[],Se=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"class-form"},[s("div",{staticClass:"row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("user.info_name")))]),s("info-input",{attrs:{msg:t.$t("user.info_name"),fill:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t.showNameError?s("div",{staticClass:"row"},[s("div",{staticClass:"label"}),s("div",{staticClass:"err-msg"},[t._v(t._s(t.$t("user.name_empty_err")))])]):t._e(),s("div",{staticClass:"row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("general.id")))]),s("info-input",{attrs:{msg:t.$t("general.id"),fill:""},model:{value:t.id,callback:function(e){t.id=e},expression:"id"}})],1),t.showIDError?s("div",{staticClass:"row"},[s("div",{staticClass:"label"}),s("div",{staticClass:"err-msg"},[t._v(t._s(t.$t("user.id_empty_err")))])]):t._e(),s("div",{staticClass:"row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("user.info_type")))]),s("dropdown-select",{attrs:{disabled:1===t.currentUserType,options:t.userTypes,width:"150px","fixed-list-width":""},model:{value:t.userType,callback:function(e){t.userType=e},expression:"userType"}})],1)])},Ne=[],Le=(s("498a"),{data:function(){return{name:"",id:"",userType:[2],userTypes:[{text:this.$t("general.student"),value:2}],showNameError:!1,showIDError:!1}},computed:Object(p["a"])({showAcountCol:function(){return 0===this.userType[0]}},Object(v["c"])(["currentUserType"])),mounted:function(){var t=this;0===t.currentUserType&&t.userTypes.unshift({text:this.$t("general.teacher"),value:1}),t.$on("validate",(function(){t.name=t.name.trim(),t.id=t.id.trim(),""===t.name&&(t.showNameError=!0),""===t.id&&(t.showIDError=!0),t.showIDError||t.showNameError||t.$emit("validateSuccess",{username:t.name,id:t.id,type:t.userType[0]})}))}}),Pe=Le,Me=(s("c01c"),Object(et["a"])(Pe,Se,Ne,!1,null,"bd8e54e4",null)),Te=Me.exports,Ue={data:function(){return{users:[],headers:[{labelKey:"general.name",class:"name",key:"username",sorting:void 0},{labelKey:"general.id",class:"name",key:"id",sorting:void 0},{labelKey:"user.info_type",class:"type",key:"type",sorting:void 0}]}},computed:Object(p["a"])({},Object(v["e"])(["userInfo"])),methods:{sort:function(t){var e=this;void 0!==t.sorting?t.sorting=!t.sorting:t.sorting=!0,e.headers.forEach((function(e){e!==t&&(e.sorting=void 0)}));var s=JSON.parse(JSON.stringify(e.users));s.sort((function(e,s){var n=t.sorting?1:-1;return e[t.key]>s[t.key]?n:-1*n})),e.users=s,e.$forceUpdate()},addUser:function(){var t=this;t.$root.$emit("pop-window",{component:Te,ok_msg:t.$t("general.add"),cancel_msg:t.$t("general.cancel"),data:{},callback:{ok:function(e){M(e).then((function(){t.$notify({group:"attendance",title:t.$t("general.update_success"),type:"success"})})).catch((function(e){t.$notify({group:"attendance",title:t.$t("user.add_user_fail"),type:"error",text:t.$t("error.".concat(e.response.data.error))})})).then((function(){return t.loadUsers()}))}},title:t.$t("user.add_user"),validate:!0,clickOutsideClose:!0})},loadUsers:function(){var t=this;return t.$startLoading(),L().then((function(e){t.users=e.result.map((function(t){var e=Object(p["a"])({},t);return void 0!==t.allowAccountLogin&&(e.type=0),e}))})).finally((function(){t.$endLoading()}))},importUsers:function(){var t=this;t.$root.$emit("pop-window",{component:Mt,ok_msg:t.$t("general.upload"),cancel_msg:t.$t("general.cancel"),callback:{ok:function(e){t.$startLoading(),G(e).then((function(e){console.log(e);var s=e.result.total,n=e.result.fail,a=0===n?"user.import_success_msg":"user.import_fail_msg";t.$notify({group:"attendance",title:0===n?t.$t("general.success"):t.$t("general.result"),type:0===n?"success":"warn",text:t.$t(a,{total:s,fail:n})})})).catch((function(e){var s=t.$te("error.".concat(e.response.data.error));t.$notify({group:"attendance",title:t.$t("general.update_fail"),type:"error",text:s?t.$t("error.".concat(e.response.data.error)):e.response.data.error})})).finally((function(){t.$endLoading(),t.loadUsers()}))}},title:t.$t("user.import_user"),validate:!0,clickOutsideClose:!1})},popDeleteUser:function(t){console.log(t);var e=this,s=e.$t("user.delete_user_msg",{name:t.username});e.$root.$emit("pop-window",{component:At,ok_msg:e.$t("general.delete"),cancel_msg:e.$t("general.cancel"),extData:{msg:s},callback:{ok:function(){Q(t.id).then((function(){e.$notify({group:"attendance",title:e.$t("general.delete_success"),type:"success"})})).finally((function(){e.loadUsers()}))}},title:e.$t("user.delete_user"),validate:!1,clickOutsideClose:!1})}},mounted:function(){this.loadUsers()}},je=Ue,De=(s("6cf9"),Object(et["a"])(je,Ie,Oe,!1,null,"781ebb15",null)),Ke=De.exports,Ae=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"user"},[s("div",{staticClass:"title row"},[s("span",{staticClass:"link click-button",on:{click:t.goUsers}},[t._v(t._s(t.$t("page.users")))]),s("div",{staticClass:"seperator"}),s("span",[t._v(t._s(t.info.name))])]),s("div",{staticClass:"row"},[s("text-button",{on:{click:function(e){return t.$router.push({name:"Users"})}}},[s("span",[t._v(t._s(t.$t("general.back_list")))])])],1),s("div",{staticClass:"block"},[s("div",{staticClass:"session"},[s("div",{staticClass:"session-title"},[t._v(t._s(t.$t("user.user_information")))]),s("div",{staticClass:"information"},t._l(Object.keys(t.info),(function(e){return s("div",{key:e,staticClass:"info-row"},[s("div",{staticClass:"name"},[t._v(t._s(t.$t("user.info_"+e)))]),s("div",{staticClass:"value"},[t._v(t._s(t.info[e]))])])})),0)]),s("div",{staticClass:"session"},[s("label-switch",{staticClass:"switch",attrs:{options:t.pageOption},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}),"keys"===t.currentPage?s("div",{staticClass:"session-page"},[s("text-button",{on:{click:function(e){return t.$router.push({name:"UserNewKey"})}}},[s("span",[t._v(t._s(t.$t("user.add_security_key")))])]),s("div",{staticClass:"list-container"},[s("div",{staticClass:"header l-row"},[s("div",{staticClass:"name"},[t._v(t._s(t.$t("general.security_key_name")))]),s("div",{staticClass:"time"},[t._v(t._s(t.$t("general.add_time")))]),s("div",{staticClass:"actions"},[t._v(t._s(t.$t("general.actions")))])]),t._l(t.keys,(function(e){return s("div",{key:e.id,staticClass:"list l-row"},[s("div",{staticClass:"name"},[t._v(" "+t._s(e.name)+" ")]),s("div",{staticClass:"time"},[t._v(" "+t._s(e.create_time)+" ")]),s("div",{staticClass:"actions"},[s("div",{staticClass:"text-link",on:{click:function(s){return t.popDeleteKey(e)}}},[t._v(t._s(t.$t("general.delete")))])])])}))],2)],1):"records"===t.currentPage?s("div",{staticClass:"session-page"},[s("text-button",{on:{click:t.downloadRecords}},[t._v(t._s(t.$t("general.export_record")))]),t.recordNum>t.recordLimit?s("div",{staticClass:"desc"},[t._v(" "+t._s(t.$t("user.too_many_record",{num:t.recordNum,limit:t.recordLimit}))+" ")]):t._e(),s("div",{staticClass:"list-container"},[s("div",{staticClass:"header l-row"},[s("div",{staticClass:"time"},[t._v(t._s(t.$t("general.time")))]),2===t.rawInfo.type?s("div",{staticClass:"class"},[t._v(t._s(t.$t("general.class")))]):t._e(),1!==t.rawInfo.type?s("div",{staticClass:"used-key"},[t._v(t._s(t.$t("general.key_used")))]):t._e(),s("div",{staticClass:"ip"},[t._v(t._s(t.$t("general.ip")))])]),t._l(t.records,(function(e){return s("div",{key:e.time,staticClass:"list l-row"},[s("div",{staticClass:"time"},[t._v(" "+t._s(e.timeStr)+" ")]),2===t.rawInfo.type?s("div",{staticClass:"class"},[t._v(" "+t._s(e.class)+" ")]):t._e(),1!==t.rawInfo.type?s("div",{staticClass:"used-key"},[t._v(" "+t._s(e.key_use_boolean)+" ")]):t._e(),s("div",{staticClass:"ip"},[t._v(" "+t._s(e.ip)+" ")])])}))],2)],1):"classes"===t.currentPage?s("div",{staticClass:"session-page"},[s("div",{staticClass:"list-container"},[s("div",{staticClass:"header l-row"},[s("div",{staticClass:"no"},[t._v(t._s(t.$t("class.class_no")))]),s("div",{staticClass:"name"},[t._v(t._s(t.$t("class.name")))])]),t._l(t.classInfos,(function(e){return s("div",{key:e.class_no,staticClass:"list l-row"},[s("div",{staticClass:"no"},[t._v(" "+t._s(e.class_no)+" ")]),s("div",{staticClass:"name"},[t._v(" "+t._s(e.name)+" ")])])}))],2)]):t._e()],1)])])},Fe=[],He=(s("a15b"),s("fb6a"),s("ddb0"),s("6b7d")),Je=s("ade3"),Re=0,Be=1,qe=2,ze={labelKey:"general.time",valueKey:"timeStr"},Ve={labelKey:"general.class",valueKey:"class"},We={labelKey:"general.key_used",valueKey:"key_use_boolean"},Ye={labelKey:"general.ip",valueKey:"ip"},Ge=(ve={},Object(Je["a"])(ve,Re,[ze,We,Ye]),Object(Je["a"])(ve,Be,[ze,Ye]),Object(Je["a"])(ve,qe,[ze,Ve,We,Ye]),ve),Qe={props:{id:{type:String}},components:{"label-switch":He["a"]},data:function(){return{info:{name:"",type:""},rawInfo:{},userType:0,currentPage:"keys",pageOption:[{val:"keys",text:this.$t("general.security_key")}],keys:[],records:[],recordLimit:30,recordNum:0,classInfos:[]}},methods:{goUsers:function(){this.$router.push({name:"Users"})},popDeleteKey:function(t){var e=this;console.log(t);var s=this,n=s.$t("user.delete_key_msg",{name:t.name});s.$root.$emit("pop-window",{component:At,ok_msg:s.$t("general.delete"),cancel_msg:s.$t("general.cancel"),extData:{msg:n},callback:{ok:function(){console.log("ok"),j(e.id,t.id).then((function(){s.$notify({group:"attendance",title:s.$t("general.delete_success"),type:"success"}),s.loadUser()})).catch((function(t){e.$notify({group:"attendance",title:e.$t("general.update_fail"),type:"warn",text:t.response.data.message})}))}},title:s.$t("user.delete_key"),validate:!1,clickOutsideClose:!1})},downloadRecords:function(){var t=this;t.$startLoading(),A(t.id).then((function(e){var s=e.result;s.forEach((function(t){t.timeStr=bt(t.time),t.key_use_boolean="FIDO Key"===t.key_use?"Yes":"No"}));var n="\ufeff",a=Ge[t.rawInfo.type]||[];n+=a.map((function(e){return t.$t(e.labelKey)})).join(","),n+="\n",s.forEach((function(t){n+=a.map((function(e){return t[e.valueKey]||""})).join(","),n+="\n"}));var i=new Blob([n],{type:"text/csv"});ae["a"].downloadRawFile(i,"".concat(t.id,"_record.csv"))})).finally((function(){t.$endLoading()}))},expandRow:function(t){this.sessions.forEach((function(t){t.expand=!1})),t.expand=!0},loadUser:function(){var t=this;return t.$startLoading(),P(t.id).then((function(e){var s=e.result;switch(t.info={name:s.name||"Name",id:s.id},t.rawInfo=s,t.classInfos=e.result.classes,s.type){case 0:t.info.type=t.$t("general.admin");break;case 1:t.info.type=t.$t("general.teacher");break;case 2:t.info.type=t.$t("general.student");break;default:}})).then((function(){return A(t.id)})).then((function(e){t.recordNum=e.result.length,t.records=e.result.slice(0,t.recordLimit),t.records.forEach((function(t){t.timeStr=bt(t.time),t.key_use_boolean="FIDO Key"===t.key_use?"Yes":"No"}))})).then((function(){return K(t.id)})).then((function(e){t.keys=e.result.map((function(t){return{id:t.id,name:t.name,create_time:bt(parseInt(t.create_time,10))}}))})).finally((function(){t.$endLoading()}))},setupPage:function(){var t=this,e=t.rawInfo;console.log(e),t.pageOption.push({val:"records",text:this.$t("general.login_record")}),0!==e.type&&t.pageOption.push({val:"classes",text:this.$t("signin.classes")})}},mounted:function(){var t=this;t.loadUser().then((function(){return t.setupPage()}))}},Xe=Qe,Ze=(s("c4fb"),Object(et["a"])(Xe,Ae,Fe,!1,null,"3d62eb2b",null)),ts=Ze.exports,es=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"profile",attrs:{id:"content"}},[s("div",{staticClass:"title row"},[t._v(t._s(t.$t("page.profile")))]),s("div",{staticClass:"block"},[s("div",{staticClass:"session"},[s("div",{staticClass:"session-title"},[t._v(t._s(t.$t("user.user_information")))]),s("div",{staticClass:"information"},[t._l(Object.keys(t.info),(function(e){return s("div",{key:e,staticClass:"info-row"},[s("div",{staticClass:"name"},[t._v(t._s(t.$t("user.info_"+e)))]),s("div",{staticClass:"value"},[t._v(t._s(t.info[e]))])])})),0===t.userType?s("div",{staticClass:"info-row"},[s("div",{staticClass:"name"},[t._v(t._s(t.$t("user.info_password")))]),s("text-button",{on:{click:t.changePassword}},[t._v(" "+t._s(t.$t("user.chagne_password"))+" ")])],1):t._e()],2)]),s("div",{staticClass:"session"},[s("label-switch",{staticClass:"switch",attrs:{options:t.pageOption},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}),"keys"===t.currentPage?s("div",{staticClass:"session-page"},[s("text-button",{on:{click:function(e){return t.$router.push({name:"ProfileNewkey",params:{id:""}})}}},[t._v(" "+t._s(t.$t("user.add_security_key")))]),s("div",{staticClass:"list-container"},[s("div",{staticClass:"header l-row"},[s("div",{staticClass:"name"},[t._v(t._s(t.$t("general.security_key_name")))]),s("div",{staticClass:"time"},[t._v(t._s(t.$t("general.add_time")))]),s("div",{staticClass:"actions"},[t._v(t._s(t.$t("general.actions")))])]),t._l(t.keys,(function(e){return s("div",{key:e.id,staticClass:"list l-row"},[s("div",{staticClass:"name"},[t._v(" "+t._s(e.name)+" ")]),s("div",{staticClass:"time"},[t._v(" "+t._s(e.create_time)+" ")]),s("div",{staticClass:"actions"},[s("div",{staticClass:"text-link",on:{click:function(s){return t.popEditKey(e)}}},[t._v(t._s(t.$t("general.edit")))]),s("div",{staticClass:"text-link",on:{click:function(s){return t.popDeleteKey(e)}}},[t._v(t._s(t.$t("general.delete")))])])])}))],2)],1):"records"===t.currentPage?s("div",{staticClass:"session-page"},[s("text-button",{on:{click:t.downloadRecords}},[t._v(t._s(t.$t("general.export_record")))]),t.recordNum>t.recordLimit?s("div",{staticClass:"desc"},[t._v(" "+t._s(t.$t("user.too_many_record",{num:t.recordNum,limit:t.recordLimit}))+" ")]):t._e(),s("div",{staticClass:"list-container"},[s("div",{staticClass:"header l-row"},[s("div",{staticClass:"time"},[t._v(t._s(t.$t("general.time")))]),2===t.userType?s("div",{staticClass:"class"},[t._v(t._s(t.$t("general.class")))]):t._e(),1!==t.userType?s("div",{staticClass:"used-key"},[t._v(t._s(t.$t("general.key_used")))]):t._e(),s("div",{staticClass:"ip"},[t._v(t._s(t.$t("general.ip")))])]),t._l(t.records,(function(e){return s("div",{key:e.time,staticClass:"list l-row"},[s("div",{staticClass:"time"},[t._v(" "+t._s(e.timeStr)+" ")]),2===t.userType?s("div",{staticClass:"class"},[t._v(" "+t._s(e.class)+" ")]):t._e(),1!==t.userType?s("div",{staticClass:"used-key"},[t._v(" "+t._s(e.key_use_boolean)+" ")]):t._e(),s("div",{staticClass:"ip"},[t._v(" "+t._s(e.ip)+" ")])])}))],2)],1):t._e()],1)])])},ss=[],ns=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("form",{staticClass:"password-form",attrs:{autocomplete:"nofill"}},[s("div",{staticClass:"password-change-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("user.new_password")))]),s("info-input",{attrs:{type:"password",autocomplete:"new-password",msg:t.$t("user.info_password"),fill:""},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1),s("div",{staticClass:"password-change-row"},[s("div",{staticClass:"label"}),t.passwordEmpty?s("div",{staticClass:"err-msg"},[t._v(t._s(t.$t("user.password_empty_err")))]):t._e()]),s("div",{staticClass:"password-change-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("user.check_password")))]),s("info-input",{attrs:{type:"password",autocomplete:"new-password",msg:t.$t("user.check_password"),fill:""},model:{value:t.checkPassword,callback:function(e){t.checkPassword=e},expression:"checkPassword"}})],1),s("div",{staticClass:"password-change-row"},[s("div",{staticClass:"label"}),t.passwordNotEqual?s("div",{staticClass:"err-msg"},[t._v(t._s(t.$t("user.check_password_not_equal")))]):t._e()])])},as=[],is={data:function(){return{password:"",checkPassword:"",passwordNotEqual:!1,passwordEmpty:!1}},mounted:function(){var t=this;t.$on("validate",(function(){t.password=t.password.trim(),t.passwordNotEqual=t.password!==t.checkPassword,t.passwordEmpty=""===t.password,t.passwordNotEqual||t.passwordEmpty||t.$emit("validateSuccess",{password:t.password})}))}},rs=is,os=(s("a401"),Object(et["a"])(rs,ns,as,!1,null,"52ae57d8",null)),cs=os.exports,ls=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"check"},[s("div",{staticClass:"title"},[t._v(t._s(t.title))]),s("info-input",{model:{value:t.data,callback:function(e){t.data=e},expression:"data"}})],1)},us=[],ds={props:{extData:{type:Object,required:!0}},data:function(){return{data:"",title:""}},mounted:function(){var t=this;this.data=this.extData.data,this.title=this.extData.title,this.$on("validate",(function(){t.$emit("validateSuccess",t.data)}))}},fs=ds,ps=(s("12b8"),Object(et["a"])(fs,ls,us,!1,null,"7e15c5ae",null)),vs=ps.exports,ms={0:"general.admin",1:"general.teacher",2:"general.student"},_s={data:function(){return{info:{name:"",type:""},userType:0,currentPage:"keys",pageOption:[],keys:[],user:{},records:[],recordLimit:30,recordNum:0,uiSet:!1}},computed:Object(p["a"])({},Object(v["e"])(["currentUser"])),watch:{currentUser:function(){this.loadUserInfo()}},methods:{downloadRecords:function(){var t=this;t.$startLoading(),A(t.currentUser).then((function(e){var s=e.result;s.forEach((function(t){t.timeStr=bt(t.time),t.key_use_boolean="FIDO Key"===t.key_use?"Yes":"No"}));var n="\ufeff",a=Ge[t.userType]||[];n+=a.map((function(e){return t.$t(e.labelKey)})).join(","),n+="\n",s.forEach((function(t){n+=a.map((function(e){return t[e.valueKey]||""})).join(","),n+="\n"}));var i=new Blob([n],{type:"text/csv"});ae["a"].downloadRawFile(i,"".concat(t.currentUser,"_record.csv"))})).finally((function(){t.$endLoading()}))},saveKey:function(t,e,s){var n=this;return D(t,e,s).then((function(){n.$notify({group:"attendance",title:n.$t("user.update_key"),type:"success",text:n.$t("fido.update_key_name",{name:s})})}))},popEditKey:function(t){var e=this,s=this;s.$root.$emit("pop-window",{component:vs,ok_msg:s.$t("general.save"),cancel_msg:s.$t("general.cancel"),extData:{title:s.$t("general.name"),data:t.name},callback:{ok:function(n){console.log(n),e.saveKey(e.currentUser,t.id,n).then((function(){t.name=n})).catch((function(){s.$notify({group:"attendance",title:s.$t("user.update_key"),type:"warning",text:s.$t("fido.update_key_name_fail",{value:n})})}))}},title:s.$t("user.update_key"),validate:!0,clickOutsideClose:!1})},popDeleteKey:function(t){var e=this;console.log(t);var s=this,n=s.$t("user.delete_key_msg",{name:t.name});s.$root.$emit("pop-window",{component:At,ok_msg:s.$t("general.delete"),cancel_msg:s.$t("general.cancel"),extData:{msg:n},callback:{ok:function(){console.log("ok"),j(e.currentUser,t.id).then((function(){s.$notify({group:"attendance",title:s.$t("general.delete_success"),type:"success"}),s.loadUserInfo()})).catch((function(t){e.$notify({group:"attendance",title:e.$t("general.update_fail"),type:"warn",text:t.response.data.message})}))}},title:s.$t("user.delete_key"),validate:!1,clickOutsideClose:!1})},changePassword:function(){var t=this;t.$root.$emit("pop-window",{component:cs,ok_msg:t.$t("general.save"),cancel_msg:t.$t("general.cancel"),callback:{ok:function(e){var s=JSON.parse(JSON.stringify(t.user));s.password=e.password,t.$startLoading(),console.log(s),T(s).then((function(){t.$notify({group:"attendance",title:t.$t("user.update_password_success"),type:"success"})})).catch((function(e){t.$notify({group:"attendance",title:t.$t("user.update_password_fail"),type:"error",text:e.toString()}),t.changePassword()})).finally((function(){t.$endLoading(),t.loadUserInfo()}))}},title:t.$t("user.chagne_password"),validate:!0,clickOutsideClose:!1})},expandRow:function(t){this.sessions.forEach((function(t){t.expand=!1})),t.expand=!0},loadUserInfo:function(){var t=this,e=this;e.currentUser&&(e.$startLoading(),P(this.currentUser).then((function(s){e.user=s.result,e.userType=s.result.type,e.info={name:s.result.name,id:s.result.id,type:e.$t(ms[s.result.type])},2===e.userType?e.currentPage="records":e.uiSet||e.pageOption.push({val:"keys",text:t.$t("general.security_key")}),e.uiSet||(e.pageOption.push({val:"records",text:t.$t("general.login_record")}),e.uiSet=!0)})).then((function(){return A(e.currentUser)})).then((function(t){e.recordNum=t.result.length,e.records=t.result.slice(0,e.recordLimit),e.records.forEach((function(t){t.timeStr=bt(t.time),t.key_use_boolean="FIDO Key"===t.key_use?"Yes":"No"}))})).then((function(){return K(t.currentUser)})).then((function(t){e.keys=t.result.map((function(t){return{id:t.id,name:t.name,create_time:bt(parseInt(t.create_time,10))}}))})).finally((function(){e.$endLoading()})))}},mounted:function(){this.loadUserInfo()}},gs=_s,hs=(s("4173"),Object(et["a"])(gs,es,ss,!1,null,"c9396d44",null)),ys=hs.exports,$s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"new-key",attrs:{id:"content"}},[t.inProfile?s("div",{staticClass:"title row"},[[s("span",{staticClass:"click-button link",on:{click:function(e){return t.goProfile()}}},[t._v(t._s(t.$t("page.profile")))]),s("div",{staticClass:"seperator"}),s("span",[t._v(t._s(t.$t("user.add_security_key")))])]],2):s("div",{staticClass:"title row"},[t.firstLogin?[s("span",[t._v(t._s(t.$t("fido.security_key_setting")))])]:[s("span",{staticClass:"click-button link",on:{click:function(e){return t.goUsers()}}},[t._v(t._s(t.$t("page.users")))]),s("div",{staticClass:"seperator"}),s("span",{staticClass:"click-button link",on:{click:function(e){return t.goUser()}}},[t._v(t._s(t.username))]),s("div",{staticClass:"seperator"}),s("span",[t._v(t._s(t.$t("user.add_security_key")))])]],2),s("div",{staticClass:"block"},[t.firstLogin?s("div",{staticClass:"block-row"},[s("span",[t._v(t._s(t.$t("user.first_add_key_desc")))])]):t._e(),""!==t.keyID?s("div",{staticClass:"block-row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("general.security_key_name")))]),s("div",{staticClass:"value"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}})])]):t._e(),t.firstLogin?s("div",{staticClass:"block-row"},[void 0===t.fido?s("text-button",{on:{click:t.newKey}},[t._v(t._s(t.$t("user.add_security_key")))]):t._e()],1):s("div",{staticClass:"block-row"},[t.needRecheck?s("text-button",{on:{click:t.newKey}},[t._v(t._s(t.$t("user.get_security_key_again")))]):t._e()],1),s("div",{staticClass:"block-row"},[void 0===t.fido||t.needRecheck?t._e():s("text-button",{on:{click:t.saveKey}},[s("span",[t._v(t._s(t.$t("general.save")))])])],1)])])},Cs=[],ws={props:{id:{required:!0}},data:function(){return{name:"",fido:void 0,needRecheck:!1,keyID:"",userID:"",inProfile:!1,username:""}},computed:Object(p["a"])({},Object(v["e"])(["firstLogin","currentUser"])),methods:Object(p["a"])(Object(p["a"])({},Object(v["d"])(["setFirstLogin"])),{},{goUsers:function(){this.$router.push({name:"Users"})},goUser:function(){this.$router.push({name:"User",params:{id:this.userID}})},goProfile:function(){this.$router.push({name:"Profile"})},saveKey:function(){var t=this;D(t.userID,t.keyID,t.name).then((function(){t.$notify({group:"attendance",title:t.$t("fido.create_key_success"),type:"success",text:t.$t("fido.update_key_name",{name:t.name})}),t.firstLogin?(t.setFirstLogin(!1),t.$router.push("/classes")):t.$router.go(-1)})).catch((function(){t.$notify({group:"attendance",title:t.$t("fido.create_key_success"),type:"warning",text:t.$t("fido.update_key_name_fail",{name:t.name})})}))},newKey:function(){var t=this,e="",s=[],n={};t.$startLoading(),P(t.userID).then((function(e){n=e.result,t.username=n.name})).then((function(){return H(t.userID)})).then((function(t){e=t.result.challenge,s=t.result.excludeCredentials})).then((function(){return pt(t.userID,t.userID,n.name,e,s).catch((function(e){console.log(e.code);var s=11===e.code?t.$t("fido.already_existed_err"):e.toString();throw 0!==e.code&&t.$notify({group:"attendance",title:t.$t("fido.create_key_error"),type:"error",text:s}),e}))})).then((function(e){console.log(e),t.fido=e,t.$startLoading()})).then((function(){return U(t.userID,t.fido).catch((function(e){throw console.log(e.response),t.$notify({group:"attendance",title:t.$t("fido.create_key_error"),type:"error",text:e.response.data.error}),e}))})).then((function(e){t.keyID=e.result.id,t.name=e.result.name,t.needRecheck=!1})).catch((function(e){console.log(e),e.response&&e.response.data&&"not_find_user"===e.response.data.error&&t.$router.push({name:"Profile"}),t.needRecheck=!0})).finally((function(){t.$endLoading()}))},useExistedKey:function(){var t=this;P(this.userID).then((function(){return vt()})).then((function(e){console.log(e),t.fido=e})).catch((function(t){console.log(t)}))}}),mounted:function(){this.userID=this.id,""===this.userID&&(this.userID=this.currentUser,this.inProfile=!0),this.firstLogin||this.newKey()}},ks=ws,bs=(s("37de"),Object(et["a"])(ks,$s,Cs,!1,null,"51472f4b",null)),xs=bs.exports,Es=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"classes"},[s("div",{staticClass:"title row"},[t._v(t._s(t.$t("campus.periods")))]),s("div",{staticClass:"row"},[s("text-button",{attrs:{"button-type":"primary"},on:{click:t.addCampus}},[t._v(t._s(t.$t("campus.add_campus")))])],1),s("div",{staticClass:"block"},t._l(t.campuses,(function(e){return s("div",{key:e.id,staticClass:"campus-block"},[s("div",{staticClass:"campus-name click-button"},[s("span",[t._v(" "+t._s(e.name)+" ")]),s("icon",{attrs:{"icon-type":"delete",size:20},on:{click:function(s){return t.deleteCampus(e)}}})],1),s("div",{staticClass:"table",class:{editing:t.editing}},[s("div",{staticClass:"fix-column"},[s("div",{staticClass:"t-cell header title"},[t._v(t._s(t.$t("campus.period")))]),s("div",{staticClass:"t-cell title"},[t._v(t._s(t.$t("campus.start_time")))]),s("div",{staticClass:"t-cell title"},[t._v(t._s(t.$t("campus.end_time")))])]),s("div",{staticClass:"scroll-column"},[t._l(e.periods,(function(n,a){return s("div",{key:a,staticClass:"scroll-column-inner"},[s("div",{staticClass:"t-cell header period"},[s("span",[t._v(t._s(a+1))]),a===e.periods.length-1&&0!==a?s("icon",{staticClass:"delete-icon",attrs:{"icon-type":"delete",size:20},on:{click:function(s){return t.deletePeriod(e,a)}}}):t._e()],1),n.editStartTime?s("div",{staticClass:"t-cell period"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.editHour,expression:"editHour"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.editHour=e.target.multiple?s:s[0]}}},t._l(t.allowHours,(function(e){return s("option",{key:e,domProps:{value:e}},[t._v(t._s(e))])})),0),t._v(" : "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.editMinute,expression:"editMinute"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.editMinute=e.target.multiple?s:s[0]}}},t._l(t.allowMinutes,(function(e){return s("option",{key:e,domProps:{value:e}},[t._v(t._s(e))])})),0),t.invalidTime?t._e():s("icon",{staticClass:"period-icon save",attrs:{"icon-type":"check_green",size:12,button:""},on:{click:function(s){return t.saveEdit(e,n,"start")}}}),s("icon",{staticClass:"period-icon cancel",attrs:{"icon-type":"delete",size:16,button:""},on:{click:function(e){return t.cancelEdit(n,"start")}}})],1):s("div",{staticClass:"t-cell period"},[t._v(" "+t._s(t.paddingNumToTwo(n.start_time.hour))+" : "+t._s(t.paddingNumToTwo(n.start_time.minute))+" "),s("icon",{staticClass:"edit-icon",attrs:{"icon-type":"edit",size:12,button:""},on:{click:function(e){return t.startEdit(n,"start")}}})],1),n.editEndTime?s("div",{staticClass:"t-cell period"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.editHour,expression:"editHour"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.editHour=e.target.multiple?s:s[0]}}},t._l(t.allowHours,(function(e){return s("option",{key:e,domProps:{value:e}},[t._v(t._s(e))])})),0),t._v(" : "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.editMinute,expression:"editMinute"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.editMinute=e.target.multiple?s:s[0]}}},t._l(t.allowMinutes,(function(e){return s("option",{key:e,domProps:{value:e}},[t._v(t._s(e))])})),0),t.invalidTime?t._e():s("icon",{staticClass:"period-icon save",attrs:{"icon-type":"check_green",size:12,button:""},on:{click:function(s){return t.saveEdit(e,n,"end")}}}),s("icon",{staticClass:"period-icon cancel",attrs:{"icon-type":"delete",size:16,button:""},on:{click:function(e){return t.cancelEdit(n,"end")}}})],1):s("div",{staticClass:"t-cell period"},[t._v(" "+t._s(t.paddingNumToTwo(n.end_time.hour))+" : "+t._s(t.paddingNumToTwo(n.end_time.minute))+" "),s("icon",{staticClass:"edit-icon",attrs:{"icon-type":"edit",size:12,button:""},on:{click:function(e){return t.startEdit(n,"end")}}})],1)])})),t.editing?t._e():s("div",{staticClass:"scroll-column-inner"},[s("div",{staticClass:"t-cell header period"},[t._v(t._s(t.$t("campus.operation")))]),s("div",{staticClass:"t-cell t-cell-2-column actions"},[s("div",{staticClass:"text-link",on:{click:function(s){return t.addPeriod(e)}}},[t._v(t._s(t.$t("general.add"))+" "+t._s(t.$t("class.period")))])])])],2)])])})),0)])},Is=[],Os=(s("a630"),s("13d5"),s("3ca3"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"class-form"},[s("div",{staticClass:"row"},[s("div",{staticClass:"label"},[t._v(t._s(t.$t("general.name")))]),s("info-input",{attrs:{msg:t.$t("campus.name_info"),fill:"",error:t.isUserNameTooltipShown,errorMsg:t.userNameErrorMsg},model:{value:t.campusName,callback:function(e){t.campusName=e},expression:"campusName"}})],1)])}),Ss=[],Ns={data:function(){return{campusName:"",nameMaxLength:64,isUserNameTooltipShown:!1,userNameErrorMsg:""}},methods:{validate:function(){this.$emit("validateSuccess",this.campusName)}},mounted:function(){this.$on("validate",this.validate)}},Ls=Ns,Ps=(s("38a8"),Object(et["a"])(Ls,Os,Ss,!1,null,"2eaf9f32",null)),Ms=Ps.exports,Ts=Array.from(new Array(24).keys()),Us=Array.from(new Array(60).keys()),js={data:function(){return{editHour:void 0,editMinute:void 0,editType:"",editPeriod:void 0,campuses:[],allowHours:[],allowMinutes:[],invalidTime:!1}},computed:{editing:function(){return this.campuses.reduce((function(t,e){return t||e.periods.reduce((function(t,e){return t||e.editStartTime||e.editEndTime}),!1)}),!1)}},watch:{editHour:function(){var t=this;switch(this.editType){case"start":this.editHour===this.editPeriod.end_time.hour?(this.allowMinutes=Us.filter((function(e){return e<t.editPeriod.end_time.minute})),this.editMinute>=this.editPeriod.end_time.minute&&(this.editMinute=this.editPeriod.end_time.minute-1)):this.allowMinutes=Us;break;case"end":this.editHour===this.editPeriod.start_time.hour?(this.allowMinutes=Us.filter((function(e){return e>t.editPeriod.start_time.minute})),this.editMinute<=this.editPeriod.start_time.minute&&(this.editMinute=this.editPeriod.start_time.minute+1)):this.allowMinutes=Us;break;default:}0===this.allowHours.length||0===this.allowMinutes.length?this.invalidTime=!0:this.invalidTime=!1}},methods:{paddingNumToTwo:kt,addCampus:function(){var t=this;t.$root.$emit("pop-window",{component:Ms,ok_msg:t.$t("general.add"),cancel_msg:t.$t("general.cancel"),data:{},callback:{ok:function(e){t.$startLoading(),E(e).then((function(){t.loadCampuses()})).then((function(){t.$notify({group:"attendance",title:t.$t("general.update_success"),type:"success"})})).catch((function(e){t.notifyException(e)})).finally((function(){t.$endLoading()}))}},title:this.$t("campus.add_campus"),validate:!0,clickOutsideClose:!0})},addPeriod:function(t){var e=this,s=this,n=JSON.parse(JSON.stringify(t)),a=9,i=0;n.periods.length>0&&(a=n.periods[n.periods.length-1].end_time.hour,i=n.periods[n.periods.length-1].end_time.minute+10,i>=60&&(a+=1,i-=60));var r=a,o=i+50;if(o>=60&&(r+=1,o-=60),a>=24)s.$notify({group:"attendance",title:s.$t("general.update_fail"),type:"error",text:s.$t("error.no_more_period")});else{var c={start_time:{hour:a,minute:i},end_time:{hour:r,minute:o}};24===c.end_time.hour&&(c.end_time.hour=23,c.end_time.minute=59),n.periods.push(c),s.$startLoading(),I(t.id,n).then((function(){return e.$notify({group:"attendance",title:e.$t("general.update_success"),type:"success"}),t=Object(p["a"])({},n),s.loadCampuses()})).catch((function(t){s.$notify({group:"attendance",title:s.$t("general.update_fail"),type:"error",text:s.$t("error.no_more_period")}),console.log(t)})).finally((function(){s.$endLoading()}))}},deleteCampus:function(t){var e=this;this.$startLoading(),O(t.id).then((function(){return e.$notify({group:"attendance",title:e.$t("general.delete_success"),type:"success"}),e.loadCampuses()})).catch((function(t){e.notifyException(t)})).finally((function(){e.$endLoading()}))},deletePeriod:function(t,e){var s=this,n=this;n.$startLoading();var a=JSON.parse(JSON.stringify(t));a.periods.splice(e,1),I(t.id,a).then((function(){return t.periods.splice(e,1),s.$notify({group:"attendance",title:s.$t("general.delete_success"),type:"success"}),n.loadCampuses()})).catch((function(t){n.notifyException(t)})).finally((function(){n.$endLoading()}))},startEdit:function(t,e){this.editType=e,this.editPeriod=t,"start"===e?(t.editStartTime=!0,this.allowHours=Ts.filter((function(e){return e<=t.end_time.hour})),t.start_time.hour===t.end_time.hour?(this.allowMinutes=Us.filter((function(e){return e<=t.end_time.minute})),0===this.allowMinutes.length&&(this.allowHours=Ts.filter((function(e){return e<t.end_time.hour})),this.allowMinutes=Us)):this.allowMinutes=Us,this.editHour=t.start_time.hour,this.editMinute=t.start_time.minute):"end"===e&&(t.editEndTime=!0,this.allowHours=Ts.filter((function(e){return e>=t.start_time.hour})),t.end_time.hour===t.start_time.hour?(this.allowMinutes=Us.filter((function(e){return e>=t.start_time.minute})),0===this.allowMinutes.length&&(this.allowHours=Ts.filter((function(e){return e>t.start_time.hour})),this.allowMinutes=Us)):this.allowMinutes=Us,this.editHour=t.end_time.hour,this.editMinute=t.end_time.minute),0===this.allowHours.length||0===this.allowMinutes.length?this.invalidTime=!0:this.invalidTime=!1,this.$forceUpdate()},cancelEdit:function(t,e){"start"===e?t.editStartTime=!1:"end"===e&&(t.editEndTime=!1),this.editHour=void 0,this.editMinute=void 0,this.$forceUpdate()},saveEdit:function(t,e,s){var n=this;n.$startLoading(),"start"===s?(e.editStartTime=!1,e.start_time.hour=n.editHour,e.start_time.minute=n.editMinute):"end"===s&&(e.editEndTime=!1,e.end_time.hour=n.editHour,e.end_time.minute=n.editMinute),n.editHour=void 0,n.editMinute=void 0,n.$forceUpdate(),n.$startLoading(),I(t.id,t).then((function(){n.$notify({group:"attendance",title:n.$t("general.update_success"),type:"success"})})).catch((function(t){n.notifyException(t)})).finally((function(){return n.$endLoading(),n.loadCampuses()})).finally((function(){n.$endLoading()}))},loadCampuses:function(){var t=this;return this.$startLoading(),x().then((function(e){t.campuses=e.result})).catch((function(t){J(t.response)})).finally((function(){t.$endLoading()}))},notifyException:function(t){var e=this;e.$notify({group:"attendance",title:e.$t("general.update_fail"),type:"error",text:e.$t("error.".concat(t.response.data.error))})}},mounted:function(){this.loadCampuses()}},Ds=js,Ks=(s("72a7"),Object(et["a"])(Ds,Es,Is,!1,null,"36b1a002",null)),As=Ks.exports,Fs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"change-password"},[s("div",{staticClass:"title row"},[s("span",[t._v(t._s(t.$t("user.chagne_password")))])]),s("div",{staticClass:"block"},[s("div",{staticClass:"desc"},[s("span",[t._v(t._s(t.$t("user.first_change_pass_desc")))])]),s("password-change-form",{ref:"form",staticClass:"form",on:{validateSuccess:t.doSave}}),s("div",{staticClass:"operation"},[s("text-button",{attrs:{"button-type":"primary"},on:{click:t.save}},[t._v(t._s(t.$t("general.save")))])],1)],1)])},Hs=[],Js={components:{"password-change-form":cs},computed:Object(p["a"])({},Object(v["e"])(["firstLogin","currentUser"])),methods:{save:function(){var t=this;t.$refs.form.$emit("validate")},doSave:function(t){var e=t.password,s=this;console.log(e),P(this.currentUser).then((function(t){var n=JSON.parse(JSON.stringify(t.result));return n.password=e,s.$startLoading(),T(n)})).then((function(){s.$notify({group:"attendance",title:s.$t("user.update_password_success"),type:"success"})})).catch((function(t){s.$notify({group:"attendance",title:s.$t("user.update_password_fail"),type:"error",text:t.toString()}),s.changePassword()})).finally((function(){s.$endLoading(),s.$router.push("/user/".concat(s.currentUser,"/newkey"))}))}},mounted:function(){}},Rs=Js,Bs=(s("eff0"),Object(et["a"])(Rs,Fs,Hs,!1,null,"43124d0a",null)),qs=Bs.exports;n["default"].use(at["a"]);var zs=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:$t},{path:"/periods",name:"Periods",component:As},{path:"/classes",name:"Classes",component:Rt},{path:"/new-class",name:"NewClass",component:Ee,props:!0},{path:"/class/:id",name:"Class",component:ue,props:!0},{path:"/class/:id/edit",name:"EditClass",component:Ee,props:!0},{path:"/class/:id/signin/:session",name:"SignIn",component:he,props:!0},{path:"/users",name:"Users",component:Ke},{path:"/user/:id",name:"User",component:ts,props:!0},{path:"/user/:id/newkey",name:"UserNewKey",component:xs,props:!0},{path:"/profile",name:"Profile",component:ys},{path:"/profile/newkey",name:"ProfileNewkey",component:xs,props:!0},{path:"/change-password",name:"ChangePassword",component:qs}],Vs=new at["a"]({mode:"hash",base:"/",routes:zs}),Ws=Vs;n["default"].use(v["a"]);var Ys=new v["a"].Store({state:{token:"",secret:"",currentPage:m[0],firstLogin:!1,currentUser:void 0,userInfo:void 0},mutations:{setPage:function(t,e){var s=m.map((function(t){return t.key}));s.indexOf(e.key)>=0&&(t.currentPage=e)},setToken:function(t,e){var s=e.token,n=e.secret;t.token=s,t.secret=n},setFirstLogin:function(t,e){t.firstLogin=e},setCurrentUser:function(t,e){t.currentUser=e}},actions:{setCurrentUserID:function(t,e){var s=t.state;return P(e).then((function(t){return s.currentUser=e,s.userInfo=t.result,t}))}},getters:{isLogin:function(t){return""!==t.token},username:function(t){return t.userInfo?t.userInfo.name:""},currentUserType:function(t){if(t.userInfo)return t.userInfo.type}},modules:{}}),Gs=s("b7d1"),Qs=s("dc75"),Xs=s("4ee1"),Zs=s("0e3f"),tn=s("5860"),en=s("cdae"),sn=s("6783"),nn=s("efa1"),an=s("e80f"),rn=s("53f7");n["default"].use(an["a"]),n["default"].use(rn["a"]),n["default"].use(r.a),n["default"].use(c.a),n["default"].component("text-button",Xs["a"]),n["default"].component("pop-windows",Zs["a"]),n["default"].component("info-input",tn["a"]),n["default"].component("icon",en["a"]),n["default"].component("dropdown-select",nn["a"]),n["default"].component("general-scroll-table",sn["a"]),n["default"].component("label-switch",He["a"]),n["default"].component("paginate",u.a),n["default"].use(a["a"]);var on=new a["a"]({locale:"en",messages:{en:Gs["a"],jp:Qs["a"]}});n["default"].config.productionTip=!1,new n["default"]({router:Ws,store:Ys,i18n:on,render:function(t){return t(nt)}}).$mount("#app")},"5c0b":function(t,e,s){"use strict";var n=s("9c0c"),a=s.n(n);a.a},"5f23":function(t,e,s){"use strict";var n=s("2afa"),a=s.n(n);a.a},"6cf9":function(t,e,s){"use strict";var n=s("a94d"),a=s.n(n);a.a},"72a7":function(t,e,s){"use strict";var n=s("a74e"),a=s.n(n);a.a},7926:function(t,e,s){"use strict";var n=s("8d02"),a=s.n(n);a.a},"7eb4":function(t,e,s){},"8d02":function(t,e,s){},"9c0c":function(t,e,s){},"9d3d":function(t,e,s){},a401:function(t,e,s){"use strict";var n=s("9d3d"),a=s.n(n);a.a},a74e:function(t,e,s){},a7a5:function(t,e,s){},a94d:function(t,e,s){},b17f:function(t,e,s){"use strict";var n=s("f2f7"),a=s.n(n);a.a},b5d0:function(t,e,s){"use strict";var n=s("0eae"),a=s.n(n);a.a},b71d:function(t,e,s){"use strict";var n=s("a7a5"),a=s.n(n);a.a},b7b4:function(t,e,s){"use strict";var n=s("40f1"),a=s.n(n);a.a},c01c:function(t,e,s){"use strict";var n=s("0502"),a=s.n(n);a.a},c4fb:function(t,e,s){"use strict";var n=s("258f"),a=s.n(n);a.a},d2c0:function(t,e,s){},d308:function(t,e,s){t.exports=s.p+"img/loginwithfido.f226a5f6.png"},dcda:function(t,e,s){},e53d:function(t,e,s){},eff0:function(t,e,s){"use strict";var n=s("1724"),a=s.n(n);a.a},f1d1:function(t,e,s){"use strict";var n=s("dcda"),a=s.n(n);a.a},f2f7:function(t,e,s){}});
//# sourceMappingURL=index.3e3907cf.js.map